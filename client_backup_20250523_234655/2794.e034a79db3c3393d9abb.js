"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[2794],{22794:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ln});var r=n(97023),a=n.n(r),s=n(23453),o=n(3569),l=n(77440),i=n(73969),c=n(7430),d=n(79342),u=n(62844),m=n(2386),p=n(67173),f=n(62688),h=n.n(f),g=n(14778),E=n(63669);const y=a().createElement("svg",{width:"142",height:"80",viewBox:"0 0 142 80",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a().createElement("g",{clipPath:"url(#clip0_4212_90546)"},a().createElement("rect",{x:"15.0059",y:"15",width:"112",height:"44",rx:"3",fill:"var(--button-bg)",fillOpacity:"0.12"}),a().createElement("path",{d:"M28.0059 34L28.0059 52L39.0059 52",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinecap:"round",strokeLinejoin:"round"}),a().createElement("path",{d:"M28.0059 31L28.0059 26",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinecap:"round",strokeLinejoin:"round"}),a().createElement("path",{d:"M28.0059 23L28.0059 21",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinecap:"round",strokeLinejoin:"round"}),a().createElement("path",{d:"M54.6108 67.5638L41.0059 81V12C41.0059 10.8954 41.9013 10 43.0059 10H109.006C110.11 10 111.006 10.8954 111.006 12V64.9868C111.006 66.0914 110.11 66.9868 109.006 66.9868H56.0162C55.4901 66.9868 54.9851 67.1941 54.6108 67.5638Z",fill:"#28427B"}),a().createElement("path",{d:"M49.6108 62.5638L36.0059 76V7C36.0059 5.89543 36.9013 5 38.0059 5H104.006C105.11 5 106.006 5.89543 106.006 7V59.9868C106.006 61.0914 105.11 61.9868 104.006 61.9868H51.0162C50.4901 61.9868 49.9851 62.1941 49.6108 62.5638Z",fill:"var(--center-channel-bg)"}),a().createElement("path",{d:"M49.2595 62.2081L36.5059 74.8035V7C36.5059 6.17157 37.1774 5.5 38.0059 5.5H104.006C104.834 5.5 105.506 6.17157 105.506 7V59.9868C105.506 60.8153 104.834 61.4868 104.006 61.4868H51.0162C50.3585 61.4868 49.7274 61.746 49.2595 62.2081Z",stroke:"var(--center-channel-color)",strokeOpacity:"0.8"}),a().createElement("circle",{cx:"54.0059",cy:"24",r:"9",fill:"var(--center-channel-color)",fillOpacity:"0.32"}),a().createElement("path",{d:"M69.0059 20H85.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46.0059 44H96.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46.0059 51H68.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M69.0059 26H94.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46.0059 38H63.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M67.0059 38H85.0059",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("rect",{x:"115.199",y:"45.0278",width:"12.4524",height:"6.22619",transform:"rotate(-135 115.199 45.0278)",fill:"var(--center-channel-bg)",stroke:"var(--center-channel-color)",strokeOpacity:"0.8"}),a().createElement("path",{d:"M117.952 42.2764L109.147 33.4712L113.787 28.8319C114.568 28.0508 115.834 28.0508 116.615 28.8319L122.592 34.8086C123.373 35.5897 123.373 36.856 122.592 37.637L117.952 42.2764Z",fill:"var(--center-channel-color)",fillOpacity:"0.32",stroke:"var(--center-channel-color)",strokeOpacity:"0.8"}),a().createElement("path",{d:"M89.3356 70.8933L80.5305 62.0882L106.946 35.6727L115.751 44.4778L89.3356 70.8933Z",fill:"var(--center-channel-bg)",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinejoin:"round"}),a().createElement("path",{d:"M73.1016 78.8725L80.5309 62.0876L89.3361 70.8928L73.1016 78.8725Z",fill:"var(--center-channel-bg)",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinejoin:"round"}),a().createElement("path",{d:"M78.3289 76.3964L75.4492 77.9756C74.5896 78.447 73.6355 77.5284 74.0739 76.6516L75.5773 73.6448L78.3289 76.3964Z",fill:"var(--center-channel-color)",fillOpacity:"0.8"}),a().createElement("line",{x1:"82.8065",y1:"64.4976",x2:"109.377",y2:"37.9268",stroke:"var(--center-channel-color)",strokeOpacity:"0.32"}),a().createElement("line",{x1:"86.6825",y1:"68.3725",x2:"113.253",y2:"41.8017",stroke:"var(--center-channel-color)",strokeOpacity:"0.32"})),a().createElement("defs",null,a().createElement("clipPath",{id:"clip0_4212_90546"},a().createElement("rect",{width:"142",height:"80",fill:"var(--center-channel-bg)",transform:"translate(0.00585938)"}))));function v(){const{formatMessage:e}=(0,g.useIntl)();return a().createElement("div",{className:"DraftList Drafts__main"},a().createElement(E.A,{expanded:!0,iconGraphic:y,title:e({id:"drafts.empty.title",defaultMessage:"No drafts at the moment"}),subtitle:e({id:"drafts.empty.subtitle",defaultMessage:"Any messages you’ve started will show here."})}))}n(17046);var _=n(71633),b=n.n(_),C=n(46177),M=n.n(C),N=n(70713),k=n(91793),S=(n(83931),n(43813),n(4290),n(75114)),T=n.n(S),P=n(81911),R=n(34574),D=n(65642),O=n(40057),I=n(65952),w=n(26614),A=n(52729),x=n(80635),L=n(14776),q=n(62563),H=n(26241),j=n(21413),F=n(8523),B=n(90661),U=n(95544),V=n(42689),z=n.n(V),K=n(30413),Y=n(90239),G=n(79751),Z=n(7395),W=n(87131);function Q(e){let{name:t,icon:n,onClick:r,id:s,tooltipText:o}=e;return a().createElement("div",{className:"DraftAction"},a().createElement(W.A,{title:o},a().createElement("button",{className:b()("DraftAction__button",{"DraftAction__button--delete":"delete"===t}),id:"draft_".concat(n,"_").concat(s),onClick:r,"aria-label":t},a().createElement("i",{className:b()("icon",n)}))))}Q.propTypes={icon:h().string.isRequired,id:h().string.isRequired,name:h().string.isRequired,onClick:h().func.isRequired,tooltipText:h().oneOfType([h().element,h().string]).isRequired};const J=Q;var X=n(14696);function $(e){let{channelDisplayName:t,onExited:n,onConfirm:s}=e;const{formatMessage:o}=(0,g.useIntl)(),[l,i]=(0,r.useState)(),c=o({id:"scheduled_post.delete_modal.title",defaultMessage:"Delete scheduled post"}),d=o({id:"drafts.confirm.delete.button",defaultMessage:"Yes, delete"}),u=(0,r.useCallback)((async()=>{const e=await s();e.error?i(e.error):n()}),[s,n]);return a().createElement(X.zW,{className:"delete_scheduled_post_modal",confirmButtonText:d,handleCancel:T(),handleConfirm:u,modalHeaderText:c,onExited:n,compassDesign:!0,isDeleteModal:!0,autoFocusConfirmButton:!0,autoCloseOnConfirmButton:!1,errorText:l},t&&a().createElement(g.FormattedMessage,{id:"scheduled_post.delete_modal.body",defaultMessage:"Are you sure you want to delete this scheduled post to <strong>{displayName}</strong>?",values:{strong:e=>a().createElement("strong",null,e),displayName:t}}),!t&&a().createElement(g.FormattedMessage,{id:"scheduled_post.delete_modal.body_no_channel",defaultMessage:"Are you sure you want to delete this scheduled post?"}))}function ee(e){let{displayName:t,onConfirm:n,onExited:r}=e;const{formatMessage:s}=(0,g.useIntl)(),o=s({id:"drafts.confirm.send.title",defaultMessage:"Send message now"}),l=s({id:"drafts.confirm.send.button",defaultMessage:"Yes, send now"}),i=a().createElement(g.FormattedMessage,{id:"drafts.confirm.send.text",defaultMessage:"Are you sure you want to send this message to <strong>{displayName}</strong>?",values:{strong:e=>a().createElement("strong",null,e),displayName:t}});return a().createElement(X.zW,{confirmButtonText:l,handleCancel:()=>{},handleConfirm:n,modalHeaderText:o,onExited:r,compassDesign:!0},i)}$.propTypes={channelDisplayName:h().string,onConfirm:h().func.isRequired,onExited:h().func.isRequired},ee.propTypes={displayName:h().string.isRequired,onConfirm:h().func.isRequired,onExited:h().func.isRequired};const te=ee;var ne=n(78451);const re=a().createElement(g.FormattedMessage,{id:"scheduled_post.action.delete",defaultMessage:"Delete scheduled post"}),ae=a().createElement(g.FormattedMessage,{id:"scheduled_post.action.edit",defaultMessage:"Edit scheduled post"}),se=a().createElement(g.FormattedMessage,{id:"scheduled_post.action.reschedule",defaultMessage:"Reschedule post"}),oe=a().createElement(g.FormattedMessage,{id:"scheduled_post.action.send_now",defaultMessage:"Send now"}),le=a().createElement(g.FormattedMessage,{id:"scheduled_post.action.copy_text",defaultMessage:"Copy text"});function ie(e){let{scheduledPost:t,channel:n,onReschedule:l,onDelete:i,onSend:d,onEdit:u,onCopyText:m}=e;const p=(0,s.useDispatch)(),f=(0,s.useSelector)(Y.FJ),h=(0,s.useSelector)((e=>(0,o.vd)(e))),g=(0,s.useSelector)((e=>(0,c.J1)(e)));(0,r.useEffect)((()=>{(null==n?void 0:n.type)===ne.Ay.DM_CHANNEL&&p((0,K.jh)([n.id]))}),[n,p]);const E=(0,r.useCallback)((()=>{const e=z().tz(t.scheduled_at,f);p((0,G.q)({modalId:ne.IQ.SCHEDULED_POST_CUSTOM_TIME_MODAL,dialogType:Z.A,dialogProps:{channelId:t.channel_id,onConfirm:l,initialTime:e}}))}),[p,l,t.channel_id,t.scheduled_at,f]),y=(0,r.useCallback)((()=>{p((0,G.q)({modalId:ne.IQ.DELETE_DRAFT,dialogType:$,dialogProps:{channelDisplayName:null==n?void 0:n.display_name,onConfirm:()=>i(t.id)}}))}),[n,p,i,t.id]),v=(0,r.useCallback)((()=>{n&&p((0,G.q)({modalId:ne.IQ.SEND_DRAFT,dialogType:te,dialogProps:{displayName:n.display_name,onConfirm:()=>d(t.id)}}))}),[n,p,d,t.id]),_=Boolean(n&&h[n.id]),b=Boolean(null==n?void 0:n.delete_at),C=!t.error_code&&_&&!b,M=(0,s.useSelector)((e=>(0,I.nO)(e,t.channel_id))),N=(!t.error_code||"unknown"===t.error_code||"unable_to_send"===t.error_code)&&n&&!b&&!M&&_,k=(!t.error_code||"unknown"===t.error_code||"unable_to_send"===t.error_code)&&_&&!b;return a().createElement("div",{className:"ScheduledPostActions"},a().createElement(J,{icon:"icon-trash-can-outline",id:"delete",name:"delete",tooltipText:re,onClick:y}),(g||C)&&a().createElement(J,{icon:"icon-pencil-outline",id:"edit",name:"edit",tooltipText:ae,onClick:u}),a().createElement(J,{icon:"icon-content-copy",id:"copy_text",name:"copy_text",tooltipText:le,onClick:m}),(g||k)&&a().createElement(J,{icon:"icon-clock-send-outline",id:"reschedule",name:"reschedule",tooltipText:se,onClick:E}),(g||N)&&a().createElement(J,{icon:"icon-send-outline",id:"sendNow",name:"sendNow",tooltipText:oe,onClick:v}))}ie.propTypes={onReschedule:h().func.isRequired,onDelete:h().func.isRequired,onSend:h().func.isRequired,onEdit:h().func.isRequired,onCopyText:h().func.isRequired};const ce=(0,r.memo)(ie);function de(e){let t,{type:n}=e;const r=a().createElement("i",{className:"icon icon-pencil-outline"}),s=a().createElement(g.FormattedMessage,{id:"scheduled_posts.row_title_thread.placeholder_tooltip",defaultMessage:"The channel either doesn’t exist or you do not have access to it."});return t="thread"===n?a().createElement(g.FormattedMessage,{id:"scheduled_posts.row_title_thread.placeholder",defaultMessage:"Thread to: {icon} No Destination",values:{icon:r}}):a().createElement(g.FormattedMessage,{id:"scheduled_posts.row_title_channel.placeholder",defaultMessage:"In: {icon} No Destination",values:{icon:r}}),a().createElement(W.A,{title:s},a().createElement("div",null,t))}de.propTypes={type:h().oneOf(["channel","thread"]).isRequired};var ue=n(5908),me=n(32580),pe=n(87778),fe=n(61185),he=n(25778),ge=n(38335),Ee=n(36598),ye=n(75270),ve=(n(57406),n(55448),n(76685),n(3188),n(29206),n(85406)),_e=n(10696),be=n(41415),Ce=n(79558),Me=n(30535),Ne=n(88100),ke=n(19513),Se=n(38564),Te=n(38884),Pe=n(92008),Re=n(62975),De=n(85873),Oe=n(4715);const Ie=e=>{let{onSave:t,onCancel:n}=e;const r=(0,s.useSelector)((e=>(0,l.Jz)(e,O.pm.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"))),o=(0,Oe.cX)()?"⌘+":"CTRL+";return a().createElement("div",{className:"post-body__footer"},a().createElement("button",{onClick:t,className:"save"},a().createElement(g.FormattedMessage,{id:"edit_post.action_buttons.save",defaultMessage:"Save"})),a().createElement("button",{onClick:n,className:"cancel"},a().createElement(g.FormattedMessage,{id:"edit_post.action_buttons.cancel",defaultMessage:"Cancel"})),a().createElement(g.FormattedMessage,{id:"edit_post.helper_text",defaultMessage:"<strong>{key}ENTER</strong> to Save, <strong>ESC</strong> to Cancel",values:{key:r?o:"",strong:e=>a().createElement("strong",null,e)}}))};Ie.propTypes={onSave:h().func.isRequired,onCancel:h().func.isRequired};const we=(0,r.memo)(Ie),Ae=["editingPost","actions","canEditPost","config","channelId","draft","scheduledPost","afterSave","onCancel","onDeleteScheduledPost"];function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){qe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{KeyCodes:He}=ne.YM,je=e=>{var t,n;let{editingPost:o,actions:l,canEditPost:i,config:c,channelId:d,draft:u,scheduledPost:m,afterSave:p,onCancel:f,onDeleteScheduledPost:h}=e,E=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,Ae);const y=(0,s.useSelector)(j.K7),v=(0,s.useSelector)((e=>(0,I.c)(e,d))),_=(0,s.useDispatch)(),[C,M]=(0,r.useState)(u.message||(null==o||null===(t=o.post)||void 0===t?void 0:t.message_source)||(null==o||null===(n=o.post)||void 0===n?void 0:n.message)||(null==m?void 0:m.message)||""),[N,k]=(0,r.useState)({start:C.length,end:C.length}),S=(0,r.useRef)(C.length),[T,P]=(0,r.useState)(null),[R,D]=(0,r.useState)(""),[O,w]=(0,r.useState)(!1),[A,x]=(0,r.useState)(!1),[L,q]=(0,r.useState)(!1),H=(0,r.useRef)(null),F=(0,r.useRef)(null),B=(0,r.useRef)(u),U=(0,r.useRef)(),V=m?m.id:o.postId,z="".concat(ne.eN.EDIT_DRAFT).concat(V),{formatMessage:K}=(0,g.useIntl)(),Y=(0,r.useCallback)((()=>{U.current&&o.postId&&(l.setDraft(z,B.current),clearTimeout(U.current),U.current=null)}),[l,z,o.postId]);(0,r.useEffect)((()=>Y),[Y]),(0,r.useEffect)((()=>{if(U.current&&clearTimeout(U.current),U.current=window.setTimeout((()=>{l.setDraft(z,B.current)}),ne.YM.SAVE_DRAFT_TIMEOUT),!m){const e=(0,Re.cS)(C).length>0;q(e)}}),[l,z,C,m]),(0,r.useEffect)((()=>{const e=()=>{var e;return null==H||null===(e=H.current)||void 0===e?void 0:e.focus()};return document.addEventListener(ne.r1.FOCUS_EDIT_TEXTBOX,e),()=>document.removeEventListener(ne.r1.FOCUS_EDIT_TEXTBOX,e)}),[]),(0,r.useEffect)((()=>{var e,t;N.start===N.end?De.vZ(null===(e=H.current)||void 0===e?void 0:e.getInputBox(),N.start):De.eG(null===(t=H.current)||void 0===t?void 0:t.getInputBox(),N.start,N.end)}),[N]);const Z=e=>k({start:e,end:e}),W=(0,r.useCallback)((e=>{const{clipboardData:t,target:n}=e;if(!t||!t.items||!i||"edit_textbox"!==n.id)return;const r=(0,Te.ON)(t),a=(0,Te.OJ)(t);if(!a&&!r)return;e.preventDefault();let s=C,o=N.start;if(a&&(0,Te.g$)(a.className)){const{formattedMessage:e,formattedCodeBlock:r}=(0,Te.rW)({selectionStart:n.selectionStart,selectionEnd:n.selectionEnd,message:s,clipboardData:t});s=e,o=N.start+r.length}else s=(0,Te.uL)(t,C.trim(),o).formattedMessage,o=s.length-(C.length-o);M(s),Z(o)}),[i,N,C]),Q=()=>{const{post:e}=o;return e&&e.file_ids&&e.file_ids.length>0||""!==C.trim()?!i:!E.canDeletePost},J=e=>{if(null===e.selectionStart||null===e.selectionEnd)return;const t=(0,Se.uD)(e);M(t.message),k({start:t.selectionStart,end:t.selectionEnd})},X=e=>{if(e){const t=document.getElementById(e);null==t||t.focus()}l.unsetEditingPost()},ee=()=>{B.current=Le(Le({},B.current),{},{message:""}),X(o.refocusId||null)},te=async()=>{var e,t,n,r;if(m)return void await ae();if(!o.post||Q())return;let s={message:C,id:o.postId,channel_id:o.post.channel_id};const i=await l.runMessageWillBeUpdatedHooks(s,o.post);if(i.error&&i.error.message)return void P(a().createElement(a().Fragment,null,i.error.message));if(s=i.data,T)return D("animation--highlight"),void setTimeout((()=>D("")),ne.YM.ANIMATION_TIMEOUT);if(s.message===((null===(e=o.post)||void 0===e?void 0:e.message_source)||(null===(t=o.post)||void 0===t?void 0:t.message)))return void ee();const c=Boolean((null===(n=o.post)||void 0===n?void 0:n.file_ids)&&(null===(r=o.post)||void 0===r?void 0:r.file_ids.length)>0);if(0!==s.message.trim().length||c)await l.editPost(s),ee(),null==p||p();else{X(null);const e={modalId:ne.IQ.DELETE_POST,dialogType:Ce.A,dialogProps:{post:o.post,isRHS:o.isRHS}};_((0,G.q)(e))}},re=(0,r.useCallback)((()=>{null==f||f(),ee()}),[f,ee]),ae=(0,r.useCallback)((async()=>{if(!m||Q()||!v||!h)return;const e=(0,_e.h_)(m);let t={message:C,id:m.id,channel_id:null==m?void 0:m.channel_id};const n=await l.runMessageWillBeUpdatedHooks(t,e);if(n.error&&n.error.message)return void P(a().createElement(a().Fragment,null,n.error.message));if(t=n.data,T)return D("animation--highlight"),void setTimeout((()=>D("")),ne.YM.ANIMATION_TIMEOUT);if(t.message===e.message)return void ee();const r=Boolean(m.file_ids&&m.file_ids.length>0);if(0===t.message.trim().length&&!r){X(null);const e={modalId:ne.IQ.DELETE_DRAFT,dialogType:$,dialogProps:{channelDisplayName:v.display_name,onConfirm:h}};return void _((0,G.q)(e))}const s=Le(Le({},m),{},{message:t.message}),o=await l.updateScheduledPost(s,y);o.error?P(o.error.message):(ee(),null==p||p())}),[l,y,C,ee,X,Q,T,m,p,v,h]),{emojiPicker:se,getReferenceProps:oe,setReference:le}=(0,Me.A)({showEmojiPicker:O,setShowEmojiPicker:w,enableGifPicker:"true"===c.EnableGifPicker,onGifClick:e=>{var t;let n=e;C.length>0&&(n=/\s+$/.test(C)?"".concat(C).concat(e):"".concat(C," ").concat(e)),B.current=Le(Le({},B.current),{},{message:n}),M(n),w(!1),null===(t=H.current)||void 0===t||t.focus()},onEmojiClick:e=>{var t;if(!e)return;const n=(0,be.Yf)(e);if(!n)return;let r=":".concat(n,": "),a=r.length;if(C.length>0){const{firstPiece:e,lastPiece:t}=(0,Pe.K_)(S.current,C);r=""===e?":".concat(n,": ").concat(t):"".concat(e," :").concat(n,": ").concat(t),a=""===e?":".concat(n,": ").length:"".concat(e," :").concat(n,": ").length}B.current=Le(Le({},B.current),{},{message:r}),M(r),Z(a),w(!1),null===(t=H.current)||void 0===t||t.focus()}});let ie=null;"true"===c.EnableEmojiPicker&&(ie=a().createElement(a().Fragment,null,a().createElement("button",Object.assign({"aria-label":K({id:"emoji_picker.emojiPicker.button.ariaLabel",defaultMessage:"select an emoji"}),id:"editPostEmoji",ref:le,className:"style--none post-action",onClick:e=>{var t;null==e||e.stopPropagation(),w(!O),O&&(null===(t=H.current)||void 0===t||t.focus())}},oe()),a().createElement(ve.EmoticonPlusOutlineIcon,{size:18,color:"currentColor"})),se));let ce="";return o.post&&(ce=o.post.root_id||o.post.id),a().createElement("div",{className:b()("post--editing__wrapper",{scroll:A}),ref:F},a().createElement(Ne.Ay,{tabIndex:0,rootId:ce,onChange:e=>{const t=e.target.value;B.current=Le(Le({},B.current),{},{message:t}),M(t)},onKeyPress:e=>{var t;const{ctrlSend:n,codeBlockOnCtrlEnter:r}=E,a=null===(t=H.current)||void 0===t?void 0:t.getInputBox(),{allowSending:s,ignoreKeyPress:o}=(0,Pe.zr)(e,C,n,r,Date.now(),0,a.selectionStart);if(o)return e.preventDefault(),void e.stopPropagation();s&&H.current&&(e.preventDefault(),H.current.blur(),te())},onKeyDown:e=>{const{ctrlSend:t,codeBlockOnCtrlEnter:n}=E,r=e.ctrlKey||e.metaKey,a=ke.r(e)&&!e.altKey&&!e.shiftKey,s=ke.r(e,!0)&&e.altKey,o=(t||n)&&ke.e(e,He.ENTER)&&r,l=ke.e(e,He.K),i=ke.r(e,!0)&&e.shiftKey&&ke.e(e,He.BACK_SLASH);De.qN(e)?(e.stopPropagation(),M(De.Co(e.nativeEvent))):o?te():ke.e(e,He.ESCAPE)&&!O?(null==f||f(),ee()):s&&l?J({markdownMode:"link",selectionStart:e.currentTarget.selectionStart,selectionEnd:e.currentTarget.selectionEnd,message:e.currentTarget.value}):a&&ke.e(e,He.B)?J({markdownMode:"bold",selectionStart:e.currentTarget.selectionStart,selectionEnd:e.currentTarget.selectionEnd,message:e.currentTarget.value}):a&&ke.e(e,He.I)?J({markdownMode:"italic",selectionStart:e.currentTarget.selectionStart,selectionEnd:e.currentTarget.selectionEnd,message:e.currentTarget.value}):i&&(e.stopPropagation(),e.preventDefault())},onBlur:e=>{const t=e.target;S.current=t.selectionEnd},onHeightChange:(e,t)=>x(e>t),handlePostError:e=>{e!==T&&P(e)},onPaste:W,value:C,channelId:d,emojiEnabled:"true"===c.EnableEmojiPicker,createMessage:K({id:"edit_post.editPost",defaultMessage:"Edit the post..."}),supportsCommands:!1,suggestionListPosition:"bottom",id:"edit_textbox",ref:H,characterLimit:E.maxPostSize,useChannelMentions:E.useChannelMentions}),a().createElement("div",{className:"post-body__actions"},ie),L?a().createElement("div",{className:"post-body__info"},a().createElement("span",{className:"post-body__info__icon"},a().createElement(ve.InformationOutlineIcon,{size:14,color:"currentColor"})),a().createElement("span",null,K({id:"edit_post.no_notification_trigger_on_mention",defaultMessage:"Editing this message with an '@mention' will not notify the recipient."}))):null,a().createElement(we,{onSave:te,onCancel:re}),T&&a().createElement("div",{className:b()("edit-post-footer",{"has-error":T})},a().createElement("label",{className:b()("post-error",R)},T)))};je.propTypes={canEditPost:h().bool,canDeletePost:h().bool,readOnlyChannel:h().bool,teamId:h().string.isRequired,channelId:h().string.isRequired,codeBlockOnCtrlEnter:h().bool.isRequired,ctrlSend:h().bool.isRequired,config:h().shape({EnableEmojiPicker:h().string,EnableGifPicker:h().string}).isRequired,maxPostSize:h().number.isRequired,useChannelMentions:h().bool.isRequired,editingPost:h().shape({postId:h().string,refocusId:h().string,title:h().string,isRHS:h().bool}).isRequired,isRHSOpened:h().bool.isRequired,isEditHistoryShowing:h().bool.isRequired,actions:h().shape({addMessageIntoHistory:h().func.isRequired,editPost:h().func.isRequired,setDraft:h().func.isRequired,unsetEditingPost:h().func.isRequired,scrollPostListToBottom:h().func.isRequired,runMessageWillBeUpdatedHooks:h().func.isRequired,updateScheduledPost:h().func.isRequired}).isRequired,afterSave:h().func,onCancel:h().func,onDeleteScheduledPost:h().func};const Fe=je,Be=(0,s.connect)((function(e,t){const n=(0,w.zj)(e),r=(0,c.WR)(e);let a,s,o,i;var d,u;t.scheduledPost?(a={post:null},s=t.scheduledPost.channel_id,o=(0,ye.UR)(e,ne.eN.EDIT_DRAFT,t.scheduledPost.id),i=!0):(a=(0,Ee.cA)(e),s=a.post.channel_id,o=(0,ye.UR)(e,ne.eN.EDIT_DRAFT,a.postId),i=(null===(d=a)||void 0===d||null===(u=d.post)||void 0===u?void 0:u.user_id)===r);const m=(0,L.Sy)(e),p=i?O.xB.DELETE_POST:O.xB.DELETE_OTHERS_POSTS,f=i?O.xB.EDIT_POST:O.xB.EDIT_OTHERS_POSTS,h=(0,I.c)(e,s),g=(0,x.Ec)(e,m,s,O.xB.USE_CHANNEL_MENTIONS);return{canEditPost:(0,x.Ec)(e,m,s,f),canDeletePost:(0,x.Ec)(e,m,s,p),codeBlockOnCtrlEnter:(0,l.Jz)(e,O.pm.CATEGORY_ADVANCED_SETTINGS,"code_block_ctrl_enter",!0),ctrlSend:(0,l.Jz)(e,O.pm.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),draft:o,config:n,editingPost:a,teamId:m,channelId:s,maxPostSize:parseInt(n.MaxPostSize||"0",10)||ne.Ay.DEFAULT_CHARACTER_LIMIT,readOnlyChannel:!(0,c.J1)(e)&&(null==h?void 0:h.name)===ne.Ay.DEFAULT_CHANNEL,useChannelMentions:g,isRHSOpened:(0,ye.A)(e),isEditHistoryShowing:(0,ye.bM)(e)===ne._n.EDIT_HISTORY,scheduledPost:t.scheduledPost}}),(function(e){return{actions:(0,ue.bindActionCreators)({scrollPostListToBottom:he.oF,addMessageIntoHistory:R.P8,editPost:ge.lD,setDraft:fe.X2,unsetEditingPost:pe.K4,runMessageWillBeUpdatedHooks:me.xO,updateScheduledPost:D.pI},e)}}))(Fe);var Ue=n(4607),Ve=n(16230);function ze(e){let{displayName:t,onExited:n,onConfirm:r}=e;const{formatMessage:s}=(0,g.useIntl)(),o=s({id:"drafts.confirm.delete.title",defaultMessage:"Delete draft"}),l=s({id:"drafts.confirm.delete.button",defaultMessage:"Yes, delete"}),i=a().createElement(g.FormattedMessage,{id:"drafts.confirm.delete.text",defaultMessage:"Are you sure you want to delete this draft to <strong>{displayName}</strong>?",values:{strong:e=>a().createElement("strong",null,e),displayName:t}});return a().createElement(X.zW,{confirmButtonText:l,handleCancel:T(),handleConfirm:r,modalHeaderText:o,onExited:n,compassDesign:!0,isDeleteModal:!0,autoFocusConfirmButton:!0},i)}ze.propTypes={displayName:h().string.isRequired,onConfirm:h().func.isRequired,onExited:h().func.isRequired};const Ke=ze,Ye=a().createElement(g.FormattedMessage,{id:"drafts.actions.scheduled",defaultMessage:"Schedule draft"});function Ge(e){let{displayName:t,onDelete:n,onEdit:o,onSend:l,canEdit:i,canSend:c,onSchedule:d,channelId:u}=e;const m=(0,s.useDispatch)(),p=(0,r.useCallback)((()=>{m((0,G.q)({modalId:ne.IQ.DELETE_DRAFT,dialogType:Ke,dialogProps:{displayName:t,onConfirm:n}}))}),[m,t,n]),f=(0,r.useCallback)((()=>{m((0,G.q)({modalId:ne.IQ.SEND_DRAFT,dialogType:te,dialogProps:{displayName:t,onConfirm:l}}))}),[m,t,l]),h=(0,r.useCallback)((()=>{m((0,G.q)({modalId:ne.IQ.SCHEDULED_POST_CUSTOM_TIME_MODAL,dialogType:Z.A,dialogProps:{channelId:u,onConfirm:d}}))}),[u,m,d]);return a().createElement(a().Fragment,null,a().createElement(J,{icon:"icon-trash-can-outline",id:"delete",name:"delete",tooltipText:a().createElement(g.FormattedMessage,{id:"drafts.actions.delete",defaultMessage:"Delete draft"}),onClick:p}),i&&a().createElement(J,{icon:"icon-pencil-outline",id:"edit",name:"edit",tooltipText:a().createElement(g.FormattedMessage,{id:"drafts.actions.edit",defaultMessage:"Edit draft"}),onClick:o}),c&&a().createElement(J,{icon:"icon-clock-send-outline",id:"reschedule",name:"reschedule",tooltipText:Ye,onClick:h}),c&&a().createElement(J,{icon:"icon-send-outline",id:"send",name:"send",tooltipText:a().createElement(g.FormattedMessage,{id:"drafts.actions.send",defaultMessage:"Send draft"}),onClick:f}))}Ge.propTypes={displayName:h().string.isRequired,onDelete:h().func.isRequired,onEdit:h().func.isRequired,onSend:h().func.isRequired,canEdit:h().bool.isRequired,canSend:h().bool.isRequired,onSchedule:h().func.isRequired,channelId:h().string.isRequired};const Ze=(0,r.memo)(Ge),We=(0,s.connect)((function(e,t){const{channelDisplayName:n,userId:r,channelName:a,channelType:s}=t;let o,i,u=n;return s===ne.YM.DM_CHANNEL&&(o=(0,Ve.r4)(r,a),i=(0,c.wz)(e,o),u=(0,d.R4)(i,(0,l.K3)(e))),{displayName:u}}))(Ze);var Qe=n(17085),Je=n(41468);function Xe(e){let{channel:t,membersCount:n,selfDraft:o,teammate:l,teammateId:i,type:c}=e;const d=(0,s.useDispatch)();(0,r.useEffect)((()=>{null!=l&&l.id||!i||d((0,Qe.WA)([i]))}),[null==l?void 0:l.id,i]),(0,r.useEffect)((()=>{t.type!==ne.YM.GM_CHANNEL||n||d((0,Qe.tF)(t.id))}),[t.id,t.type,d,n]);let u=null,m=null;o&&(u=a().createElement(a().Fragment,null," ",a().createElement(g.FormattedMessage,{id:"drafts.draft_title.you",defaultMessage:"(you)"})));let p=a().createElement("i",{className:"icon icon-globe"});return t.type===ne.YM.PRIVATE_CHANNEL&&(p=a().createElement("i",{className:"icon icon-lock-outline"})),t.type===ne.YM.DM_CHANNEL&&l&&(p=a().createElement(Je.A,{size:"xs",username:l.username,url:(0,De.RG)(l.id,l.last_picture_update),className:"DraftTitle__avatar"})),t.type===ne.YM.GM_CHANNEL&&(p=a().createElement("div",{className:"DraftTitle__group-icon"},n)),m="thread"===c?t.type!==ne.YM.GM_CHANNEL&&t.type!==ne.YM.DM_CHANNEL?a().createElement(g.FormattedMessage,{id:"drafts.draft_title.channel_thread",defaultMessage:"Thread in: {icon} <span>{channelName}</span>",values:{icon:p,channelName:t.display_name,span:e=>a().createElement("span",null,e)}}):a().createElement(g.FormattedMessage,{id:"drafts.draft_title.direct_thread",defaultMessage:"Thread to: {icon} <span>{channelName}</span>",values:{icon:p,channelName:t.display_name,span:e=>a().createElement("span",null,e)}}):t.type!==ne.YM.GM_CHANNEL&&t.type!==ne.YM.DM_CHANNEL?a().createElement(g.FormattedMessage,{id:"drafts.draft_title.channel",defaultMessage:"In: {icon} <span>{channelName}</span>",values:{icon:p,channelName:t.display_name,span:e=>a().createElement("span",null,e)}}):a().createElement(g.FormattedMessage,{id:"drafts.draft_title.direct_channel",defaultMessage:"To: {icon} <span>{channelName}</span>",values:{icon:p,channelName:t.display_name,span:e=>a().createElement("span",null,e)}}),a().createElement(a().Fragment,null,m,u)}Xe.propTypes={membersCount:h().number,selfDraft:h().bool.isRequired,teammateId:h().string,type:h().oneOf(["channel","thread"]).isRequired};const $e=(0,r.memo)(Xe),et=(0,s.connect)((function(){const e=(0,I.fV)();return(t,n)=>{const{channel:r,userId:a}=n;let s,o,l;return r.type===ne.YM.GM_CHANNEL&&(l=e(t,r)),r.type===ne.YM.DM_CHANNEL&&(s=(0,Ve.r4)(a,r.name),o=(0,c.wz)(t,s)),{channel:r,membersCount:l,selfDraft:s===a,teammate:o,teammateId:s}}}))($e),tt=(0,De.NL)(".hljs, code");function nt(e){let{children:t,onClick:n,hasError:r,innerRef:s,isHighlighted:o,style:l,className:i,dataTestId:c,dataPostId:d,ariaLabel:u}=e;return a().createElement("div",{"data-testid":c,"data-postid":d,className:b()("Panel",{draftError:r,highlighted:o},i),style:l,onClick:e=>{tt(e)&&n()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n()},role:"link",tabIndex:0,ref:s,"aria-label":u},t)}nt.propTypes={children:h().node.isRequired,onClick:h().func.isRequired,hasError:h().bool.isRequired,innerRef:h().oneOfType([h().string,h().func,h().object]),isHighlighted:h().bool,className:h().string,dataTestId:h().string,dataPostId:h().string,ariaLabel:h().string};const rt=(0,r.memo)(nt);var at=n(35813),st=n(85234),ot=n(18515),lt=n(17001),it=n(61767);const ct={disableGroupHighlight:!0,mentionHighlight:!1};function dt(e){let{channelId:t,displayName:n,fileInfos:o,message:l,priority:i,status:c,uploadsInProgress:d,userId:u,username:m}=e;const p=(0,s.useSelector)(L._p),f=(0,r.useCallback)((e=>{(0,De.oO)(e,p)}),[p]);return a().createElement("div",{className:"DraftPanelBody post"},a().createElement("div",{className:"DraftPanelBody__left post__img"},a().createElement(it.A,{status:c,channelId:t,username:m,userId:u,size:"md",src:(0,De.RG)(u)})),a().createElement("div",{className:"DraftPanelBody__post_body"},a().createElement(lt.A,{text:l},a().createElement("div",{onClick:f,className:"post__content"},a().createElement("div",{className:"DraftPanelBody__right"},a().createElement("div",{className:"post__header"},a().createElement("strong",null,n),i&&a().createElement(at.A,{canRemove:!1,hasError:!1,persistentNotifications:i.persistent_notifications,priority:i.priority,requestedAck:i.requested_ack})),a().createElement("div",{className:"post__body"},a().createElement(ot.A,{options:ct,message:l}))))),(o.length>0||(null==d?void 0:d.length)>0)&&a().createElement(st.A,{fileInfos:o,uploadsInProgress:d})))}dt.propTypes={channelId:h().string,displayName:h().string.isRequired,message:h().string.isRequired};const ut=dt;var mt=n(9783);const pt=(0,g.defineMessages)({unknown:{id:"scheduled_post.error_code.unknown_error",defaultMessage:"Unknown Error"},channel_archived:{id:"scheduled_post.error_code.channel_archived",defaultMessage:"Channel Archived"},channel_not_found:{id:"scheduled_post.error_code.channel_removed",defaultMessage:"Channel Removed"},user_missing:{id:"scheduled_post.error_code.user_missing",defaultMessage:"User Deleted"},user_deleted:{id:"scheduled_post.error_code.user_deleted",defaultMessage:"User Deleted"},no_channel_permission:{id:"scheduled_post.error_code.no_channel_permission",defaultMessage:"Missing Permission"},no_channel_member:{id:"scheduled_post.error_code.no_channel_member",defaultMessage:"Not In Channel"},thread_deleted:{id:"scheduled_post.error_code.thread_deleted",defaultMessage:"Thread Deleted"},unable_to_send:{id:"scheduled_post.error_code.unable_to_send",defaultMessage:"Unable to Send"},invalid_post:{id:"scheduled_post.error_code.invalid_post",defaultMessage:"Invalid Post"}});function ft(e){var t;const n=null!==(t=pt[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown"])&&void 0!==t?t:pt.unknown;return e.formatMessage(n).toUpperCase()}function ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(n),!0).forEach((function(t){Et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Et(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const yt={current:0};function vt(e){var t;let{item:n,user:o,status:l,displayName:i,isRemote:c,scrollIntoView:d,containerClassName:u}=e;const[p,f]=(0,r.useState)(!1),h="scheduled_at"in n,E=(0,g.useIntl)(),y="rootId"in n?n.rootId:n.root_id,v="channelId"in n?n.channelId:n.channel_id,[_,b]=(0,r.useState)(null),C=(0,P.useHistory)(),M=(0,s.useDispatch)(),N=(0,r.useMemo)((()=>(0,I.s9)()),[]),k=(0,s.useSelector)((e=>N(e,v))),S=(0,r.useMemo)((()=>(0,q.pL)()),[]),V=(0,s.useSelector)((e=>{if(!y)return!1;const t=(0,A.f5)(e,y);return!t||t.delete_at>0||"DELETED"===t.state})),z=(0,s.useSelector)((e=>{const t=parseInt((0,w.zj)(e).MaxPostSize||"",10)||ne.Ay.DEFAULT_CHARACTER_LIMIT;return n.message.length>t})),K=!(0,s.useSelector)((e=>!!k&&(0,x.Ec)(e,k.team_id,k.id,O.xB.CREATE_POST))),Y=(0,s.useSelector)(j.K7),G=Boolean(null==k?void 0:k.delete_at),Z=(0,s.useSelector)((e=>(0,I.nO)(e,v)));let W="";h?n.error_code?W=ft(E,n.error_code):(G||Z)&&(W=ft(E,"channel_archived")):V?W=E.formatMessage({id:"drafts.error.post_not_found",defaultMessage:"Thread not found"}):z?W=E.formatMessage({id:"drafts.error.too_long",defaultMessage:"Message too long"}):K&&(W=E.formatMessage({id:"drafts.error.read_only",defaultMessage:"Channel is read only"}));const Q=!W,J=!(V||K),X=(0,s.useSelector)((e=>{if(!k)return"";const t=(0,L.Sy)(e);return(0,F.H)(e,k,t)})),$=(0,r.useCallback)((async()=>{if(!p)if(y){if(V)return;await M((0,m.n0)(y))}else C.push(X)}),[X,M,C,y,V,p]),ee=(0,r.useRef)(!1),te=(0,r.useRef)(!1),re=(0,s.useSelector)((e=>{if(!y)return;const t=(0,A.f5)(e,y);return t?S(e,t):void 0})),ae=(0,r.useCallback)((()=>{let e="".concat(ne.eN.DRAFT).concat(v);y&&(e="".concat(ne.eN.COMMENT_DRAFT).concat(y)),M((0,H.AB)(e,v,y))}),[M,v,y]),se=(0,r.useCallback)((e=>{if(ee.current&&e.created&&!e.error&&(ae(),ee.current=!1),te.current&&e.created&&!e.error){const e=n;M((0,D.FF)(e.user_id,e.id,Y)),te.current=!1}}),[Y,M,ae,n]),{onSubmitCheck:oe}=(0,B.A)(n,T(),T(),!1),[le]=(0,U.A)(n,W,v,y,_,yt,T(),b,T(),T(),oe,$,se,!0),ie=(0,r.useCallback)((async e=>(ee.current=!0,await le(n,{scheduled_at:e}),Promise.resolve({}))),[n,le]),ue=(0,r.useMemo)((()=>k?a().createElement(We,{channelDisplayName:k.display_name,channelName:k.name,channelType:k.type,channelId:k.id,userId:o.id,onDelete:ae,onEdit:$,onSend:le,canEdit:J,canSend:Q,onSchedule:ie}):null),[J,Q,k,$,ae,le,o.id,ie]),me=(0,r.useCallback)((()=>{f(!1)}),[]),pe=(0,r.useCallback)((async e=>{var t;me();const r=gt(gt({},n),{},{scheduled_at:e});return{error:null===(t=(await M((0,D.pI)(r,Y))).error)||void 0===t?void 0:t.message}}),[Y,M,n,me]),fe=(0,r.useCallback)((async()=>{var e;me();const t=n;return{error:null===(e=(await M((0,D.FF)(t.user_id,t.id,Y))).error)||void 0===e?void 0:e.message}}),[n,M,Y,me]),he=(0,r.useCallback)((()=>{f((e=>!e))}),[]),ge=(0,r.useCallback)((()=>{(0,De.lW)(n.message)}),[n]),Ee=(0,r.useCallback)((()=>{me(),te.current=!0;const e=(0,Ue.Y)(n);return le(e,void 0,{keepDraft:!0,ignorePostError:!0}),Promise.resolve({})}),[le,n,me]),ye=(0,r.useMemo)((()=>a().createElement(ce,{scheduledPost:n,channel:k,onReschedule:pe,onDelete:fe,onSend:Ee,onEdit:he,onCopyText:ge})),[k,fe,pe,Ee,he,ge,n]);(0,r.useEffect)((()=>{!y||null!=re&&re.id||M((0,R.f5)(y))}),[null==re?void 0:re.id,y]);const ve=function(){const e=a().useRef(null);return a().useEffect((()=>{e.current&&e.current.scrollIntoView({behavior:"smooth"})}),[]),e}();if(!k&&!h)return null;let _e,be,Ce,Me;var Ne;let ke;h?(_e=n.scheduled_at,be=(null===(Ne=n.metadata)||void 0===Ne?void 0:Ne.files)||[],Ce=[],Me=ye):(_e=n.updateAt,be=n.fileInfos,Ce=n.uploadsInProgress,Me=ue),ke=k?a().createElement(et,{type:y?"thread":"channel",channel:k,userId:o.id}):a().createElement(de,{type:y?"thread":"channel"});const Se=h?"scheduledPost":"draft";return a().createElement(rt,{dataTestId:"".concat(Se,"View"),dataPostId:n.id,onClick:$,hasError:Boolean(W),innerRef:d?ve:void 0,isHighlighted:d,className:u,ariaLabel:h?E.formatMessage({id:"drafts.draft_row.aria_label.scheduled_post",defaultMessage:"scheduled post in {channelName}"},{channelName:null==k?void 0:k.display_name}):E.formatMessage({id:"drafts.draft_row.aria_label.draft",defaultMessage:"draft in {channelName}"},{channelName:null==k?void 0:k.display_name})},a().createElement(mt.Ay,{kind:Se,actions:Me,title:ke,timestamp:_e,remote:c||!1,error:W||(null==_?void 0:_.message)}),p&&a().createElement(Be,{scheduledPost:n,onCancel:me,afterSave:me,onDeleteScheduledPost:fe}),!p&&a().createElement(ut,{channelId:null==k?void 0:k.id,displayName:i,fileInfos:be,message:n.message,status:l,priority:y||null===(t=n.metadata)||void 0===t?void 0:t.priority,uploadsInProgress:Ce,userId:o.id,username:o.username}))}vt.propTypes={displayName:h().string.isRequired,isRemote:h().bool,scrollIntoView:h().bool,containerClassName:h().string,dataTestId:h().string,dataPostId:h().string};const _t=(0,r.memo)(vt);function bt(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(new Map),s=(0,r.useCallback)(((e,r,a)=>{const s=n.current.get(r);(!s||Math.abs(s-a)>4)&&(n.current.set(r,a),t.current&&t.current.resetAfterIndex(e))}),[]),o=(0,r.useCallback)((t=>{const r=t<e.drafts.length?e.drafts[t].key:"";return r&&n.current.get(r)||0}),[e.drafts]),l=(0,r.useMemo)((()=>({drafts:e.drafts,userDisplayName:e.userDisplayName,draftRemotes:e.draftRemotes,currentUser:e.currentUser,userStatus:e.userStatus,setRowHeight:s})),[e.drafts,e.userDisplayName,e.draftRemotes,e.currentUser,e.userStatus,s]);return a().createElement("div",{className:"DraftList Drafts__main"},a().createElement(N.Ay,null,(n=>{let{height:r,width:s}=n;return a().createElement(k._m,{ref:t,height:r,width:s,itemCount:e.drafts.length,itemSize:o,itemData:l,overscanCount:6},Mt)})))}function Ct(e){let{index:t,style:n,data:{drafts:s,userDisplayName:o,draftRemotes:l,currentUser:i,userStatus:c,setRowHeight:d}}=e;const u=s[t],m=(0,r.useRef)(null),p=(0,r.useRef)(t),f=(0,r.useRef)(u.key),h=(0,r.useRef)(d);return(0,r.useEffect)((()=>{p.current=t,f.current=u.key,h.current=d}),[t,u.key,d]),(0,r.useEffect)((()=>{if(!m.current)return;const e=requestAnimationFrame((()=>{if(!m.current)return;const e=m.current.getBoundingClientRect().height;d(t,u.key,e)}));return()=>{cancelAnimationFrame(e)}}),[u,d,t]),(0,r.useEffect)((()=>{if(!m.current)return;let e=!0;const t=M()((t=>{e&&m.current&&h.current(p.current,f.current,t)}),120),n=new ResizeObserver((n=>{if(e&&m.current&&1===n.length&&n[0].target===m.current){const e=n[0].borderBoxSize[0].blockSize;t(e)}}));return n.observe(m.current),()=>{e=!1,t.cancel(),n.disconnect()}}),[]),a().createElement("div",{style:n}," ",a().createElement("div",{ref:m,className:b()("virtualizedVariableListRowWrapper",{firstRow:0===t})},a().createElement(_t,{key:u.key,item:u.value,displayName:o,user:i,status:c,isRemote:null==l?void 0:l[u.key]})))}bt.propTypes={drafts:h().array.isRequired,userDisplayName:h().string.isRequired,draftRemotes:h().objectOf(h().bool).isRequired},Ct.propTypes={index:h().number.isRequired,data:h().shape({drafts:h().array.isRequired,userDisplayName:h().string.isRequired,draftRemotes:h().objectOf(h().bool).isRequired,userStatus:h().string.isRequired,setRowHeight:h().func.isRequired}).isRequired};const Mt=(0,r.memo)(Ct);function Nt(e){const t=(0,s.useSelector)(p.L9);return 0===e.drafts.length?a().createElement(v,null):a().createElement(bt,{drafts:e.drafts,currentUser:e.currentUser,userDisplayName:e.userDisplayName,userStatus:e.userStatus,draftRemotes:t})}Nt.propTypes={drafts:h().array.isRequired,userDisplayName:h().string.isRequired};var kt=n(93725),St=n(41125);function Tt(e){return a().createElement("div",{id:"app-content",className:"Drafts app__content"},a().createElement(St.A,{level:2,className:"Drafts__header",heading:a().createElement(g.FormattedMessage,{id:"drafts.heading",defaultMessage:"Drafts"}),subtitle:a().createElement(g.FormattedMessage,{id:"drafts.subtitle",defaultMessage:"Any messages you've started will show here"})}),e.children)}var Pt=n(68102),Rt=n(49257),Dt=n(81023);var Ot=n(29009),It=n(12356);function wt(e){return(0,It.Ay)("MuiBadge",e)}(0,Ot.A)("MuiBadge",["root","badge","invisible"]);var At=n(95591),xt=n(68017);function Lt(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"==typeof e[t]))).forEach((n=>{t[n]=e[n]})),t}const qt=["elementType","externalSlotProps","ownerState"];function Ht(e){var t;const{elementType:n,externalSlotProps:r,ownerState:a}=e,s=(0,Rt.A)(e,qt),o=function(e,t){return"function"==typeof e?e(t):e}(r,a),{props:l,internalRef:i}=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:r,externalForwardedProps:a,className:s}=e;if(!t){const e=(0,xt.A)(null==a?void 0:a.className,null==r?void 0:r.className,s,null==n?void 0:n.className),t=(0,Pt.A)({},null==n?void 0:n.style,null==a?void 0:a.style,null==r?void 0:r.style),o=(0,Pt.A)({},n,a,r);return e.length>0&&(o.className=e),Object.keys(t).length>0&&(o.style=t),{props:o,internalRef:void 0}}const o=function(e,t=[]){if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"==typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n}((0,Pt.A)({},a,r)),l=Lt(r),i=Lt(a),c=t(o),d=(0,xt.A)(null==c?void 0:c.className,null==n?void 0:n.className,s,null==a?void 0:a.className,null==r?void 0:r.className),u=(0,Pt.A)({},null==c?void 0:c.style,null==n?void 0:n.style,null==a?void 0:a.style,null==r?void 0:r.style),m=(0,Pt.A)({},c,n,i,l);return d.length>0&&(m.className=d),Object.keys(u).length>0&&(m.style=u),{props:m,internalRef:c.ref}}((0,Pt.A)({},s,{externalSlotProps:o})),c=(0,At.A)(i,null==o?void 0:o.ref,null==(t=e.additionalProps)?void 0:t.ref),d=function(e,t,n){return void 0===e||"string"==typeof e?t:(0,Pt.A)({},t,{ownerState:(0,Pt.A)({},t.ownerState,n)})}(n,(0,Pt.A)({},l,{ref:c}),a);return d}var jt=n(62540);const Ft={disableDefaultClasses:!1},Bt=r.createContext(Ft),Ut=["badgeContent","component","children","invisible","max","slotProps","slots","showZero"],Vt=r.forwardRef((function(e,t){const{component:n,children:a,max:s=99,slotProps:o={},slots:l={},showZero:i=!1}=e,c=(0,Rt.A)(e,Ut),{badgeContent:d,max:u,displayValue:m,invisible:p}=function(e){const{badgeContent:t,invisible:n=!1,max:a=99,showZero:s=!1}=e,o=(e=>{const t=r.useRef({});return r.useEffect((()=>{t.current=e})),t.current})({badgeContent:t,max:a});let l=n;!1!==n||0!==t||s||(l=!0);const{badgeContent:i,max:c=a}=l?o:e;return{badgeContent:i,invisible:l,max:c,displayValue:i&&Number(i)>c?`${c}+`:i}}((0,Pt.A)({},e,{max:s})),f=(0,Pt.A)({},e,{badgeContent:d,invisible:p,max:u,showZero:i}),h=(e=>{const{invisible:t}=e,n={root:["root"],badge:["badge",t&&"invisible"]};return(0,Dt.A)(n,function(e){const{disableDefaultClasses:t}=r.useContext(Bt);return n=>t?"":e(n)}(wt))})(f),g=n||l.root||"span",E=Ht({elementType:g,externalSlotProps:o.root,externalForwardedProps:c,additionalProps:{ref:t},ownerState:f,className:h.root}),y=l.badge||"span",v=Ht({elementType:y,externalSlotProps:o.badge,ownerState:f,className:h.badge});return(0,jt.jsxs)(g,(0,Pt.A)({},E,{children:[a,(0,jt.jsx)(y,(0,Pt.A)({},v,{children:m}))]}))}));var zt=n(60853);const Kt=a().createElement("svg",{width:"142",height:"87",viewBox:"0 0 142 87",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a().createElement("g",{clipPath:"url(#clip0_4212_90995)"},a().createElement("rect",{x:"15",y:"15",width:"112",height:"44",rx:"3",fill:"var(--button-bg)",fillOpacity:"0.12"}),a().createElement("path",{d:"M29.5 75L29.5 47L40 47",stroke:"var(--center-channel-color)",strokeOpacity:"0.32",strokeLinecap:"round"}),a().createElement("path",{d:"M45 43H29.5V9.5L22.5 2.5",stroke:"var(--center-channel-color)",strokeOpacity:"0.32",strokeLinecap:"round"}),a().createElement("circle",{cx:"2.5",cy:"2.5",r:"2.5",transform:"matrix(1 0 0 -1 20 5)",fill:"var(--center-channel-color)",fillOpacity:"0.48"}),a().createElement("circle",{cx:"2.5",cy:"2.5",r:"2.5",transform:"matrix(1 0 0 -1 27 78)",fill:"var(--center-channel-color)",fillOpacity:"0.48"}),a().createElement("path",{d:"M127 22.5L117 22.5L117 49",stroke:"var(--center-channel-color)",strokeOpacity:"0.32",strokeLinecap:"round"}),a().createElement("circle",{cx:"128.5",cy:"22.5",r:"2.5",fill:"var(--center-channel-color)",fillOpacity:"0.48"}),a().createElement("path",{d:"M54.605 67.5638L41 81V12C41 10.8954 41.8954 10 43 10H109C110.105 10 111 10.8954 111 12V64.9868C111 66.0914 110.105 66.9868 109 66.9868H56.0103C55.4842 66.9868 54.9793 67.1941 54.605 67.5638Z",fill:"#28427B"}),a().createElement("path",{d:"M49.605 62.5638L36 76V7C36 5.89543 36.8954 5 38 5H104C105.105 5 106 5.89543 106 7V59.9868C106 61.0914 105.105 61.9868 104 61.9868H51.0103C50.4842 61.9868 49.9793 62.1941 49.605 62.5638Z",fill:"var(--center-channel-bg)"}),a().createElement("path",{d:"M49.2536 62.2081L36.5 74.8035V7C36.5 6.17157 37.1716 5.5 38 5.5H104C104.828 5.5 105.5 6.17157 105.5 7V59.9868C105.5 60.8153 104.828 61.4868 104 61.4868H51.0103C50.3527 61.4868 49.7215 61.746 49.2536 62.2081Z",stroke:"var(--center-channel-color)",strokeOpacity:"0.8"}),a().createElement("circle",{cx:"54",cy:"24",r:"9",fill:"var(--center-channel-color)",fillOpacity:"0.32"}),a().createElement("path",{d:"M69 20H85",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46 44H96",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46 51H68",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M69 26H94",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M46 38H63",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{d:"M67 38H85",stroke:"var(--center-channel-color)",strokeOpacity:"0.48",strokeLinecap:"round"}),a().createElement("path",{opacity:"0.32",d:"M114.218 87.29C106.772 87.1409 100.598 84.5917 95.6936 79.6423C90.7897 74.6929 88.2252 68.5281 88 61.1479C88.2213 53.7639 90.7859 47.5971 95.6936 42.6477C100.601 37.6983 106.776 35.1491 114.218 35C121.591 35.1529 127.73 37.7021 132.633 42.6477C137.537 47.5933 140.102 53.76 140.327 61.1479C140.098 68.5319 137.534 74.6967 132.633 79.6423C127.733 84.5879 121.595 87.1371 114.218 87.29Z",fill:"var(--center-channel-color)",fillOpacity:"0.32"}),a().createElement("path",{d:"M111.218 82.7899C103.897 82.6411 97.8524 80.1385 93.0488 75.2904C88.243 70.4399 85.7248 64.403 85.5002 57.1477C85.7211 49.8888 88.2392 43.8501 93.0487 38.9998C97.8561 34.1515 103.901 31.6489 111.218 31.5001C118.465 31.6526 124.474 34.1544 129.278 38.9998C134.084 43.8462 136.602 49.8848 136.827 57.1477C136.598 64.407 134.08 70.4439 129.278 75.2904C124.478 80.1356 118.469 82.6374 111.218 82.7899Z",fill:"var(--center-channel-bg)",stroke:"var(--center-channel-color)"}),a().createElement("path",{d:"M111.042 77C105.35 76.886 100.63 74.9359 96.8812 71.1498C93.1325 67.3636 91.1721 62.6478 91 57.0022C91.1692 51.3537 93.1296 46.6364 96.8812 42.8502C100.633 39.0641 105.353 37.114 111.042 37C116.678 37.1169 121.37 39.067 125.119 42.8502C128.867 46.6334 130.828 51.3508 131 57.0022C130.825 62.6507 128.865 67.3666 125.119 71.1498C121.373 74.933 116.681 76.8831 111.042 77Z",fill:"var(--center-channel-bg)"}),a().createElement("path",{d:"M111.041 76.4999C105.475 76.3862 100.885 74.4827 97.2365 70.798C93.5858 67.1108 91.6718 62.5228 91.5002 57.0021C91.6689 51.4785 93.583 46.8892 97.2364 43.2022C100.888 39.5172 105.478 37.6138 111.041 37.5001C116.552 37.6167 121.114 39.5192 124.764 43.2022C128.414 46.8862 130.328 51.4754 130.5 57.0021C130.325 62.5259 128.411 67.1139 124.763 70.798C121.117 74.4807 116.555 76.3833 111.041 76.4999Z",stroke:"var(--center-channel-color)",strokeOpacity:"0.32"}),a().createElement("path",{d:"M111 35.5V57L120.5 66.5",stroke:"var(--center-channel-color)",strokeOpacity:"0.8",strokeLinejoin:"round"}),a().createElement("circle",{cx:"111",cy:"57",r:"2",fill:"var(--center-channel-color)",fillOpacity:"0.8"})),a().createElement("defs",null,a().createElement("clipPath",{id:"clip0_4212_90995"},a().createElement("rect",{width:"142",height:"87",fill:"white"}))));function Yt(){const{formatMessage:e}=(0,g.useIntl)();return a().createElement(zt.A,{expanded:!0,iconGraphic:Kt,title:e({id:"Schedule_post.empty_state.title",defaultMessage:"No scheduled drafts at the moment"}),subtitle:e({id:"Schedule_post.empty_state.subtitle",defaultMessage:"Schedule drafts to send messages at a later time. Any scheduled drafts will show up here and can be modified after being scheduled."})})}var Gt=n(54302);function Zt(e){const t=(0,Gt.I)().get("target_id"),n=(0,r.useRef)();return a().createElement(a().Fragment,null,e.scheduledPosts.map(((r,s)=>{const o=r.channel_id===t||r.root_id===t,l=Boolean(r.error_code);return!n.current&&o&&!l&&(n.current=r.id),a().createElement(_t,{key:r.id,item:r,displayName:e.userDisplayName,status:e.userStatus,user:e.currentUser,scrollIntoView:n.current===r.id,containerClassName:b()("nonVirtualizedScheduledPostRow",{firstRow:0===s})})})))}Zt.propTypes={scheduledPosts:h().array.isRequired,userDisplayName:h().string.isRequired};var Wt=n(44553);function Qt(){return a().createElement(Wt.A,{mode:"danger",className:"scheduledPostListErrorIndicator",message:a().createElement(g.FormattedMessage,{id:"scheduled_post.panel.error_indicator.message",defaultMessage:"One of your scheduled drafts cannot be sent."})})}function Jt(e){const t=(0,s.useDispatch)(),n=(0,s.useSelector)(L.Sy),o=(0,s.useSelector)((e=>(0,i.U)(e,n)));return(0,r.useEffect)((()=>{e.scheduledPosts.length>0&&t((0,K.jh)(e.scheduledPosts.map((e=>e.channel_id))))}),[t,e.scheduledPosts]),0===e.scheduledPosts.length?a().createElement(Yt,null):a().createElement("div",{className:"ScheduledPostList nonVirtualizedScheduledPostList"},o&&a().createElement(Qt,null),a().createElement(Zt,{scheduledPosts:e.scheduledPosts,currentUser:e.currentUser,userDisplayName:e.userDisplayName,userStatus:e.userStatus}))}Jt.propTypes={scheduledPosts:h().array.isRequired,userDisplayName:h().string.isRequired};var Xt=n(34529);function $t(e){let{children:t,title:n,unmountOnExit:r,tabClassName:s,eventKey:o,tabIndex:l=-1}=e;return a().createElement(Xt.Tab,{eventKey:o,title:n,unmountOnExit:r,tabClassName:s,tabIndex:l},t)}function en(e){let{children:t,id:n,activeKey:r,unmountOnExit:s,onSelect:o,className:l,mountOnEnter:i}=e;return a().createElement(Xt.Tabs,{id:n,activeKey:r,unmountOnExit:s,onSelect:o,className:b()("tabs",l),mountOnEnter:i,autoFocus:!0},t)}$t.propTypes={children:h().node,eventKey:h().any,tabIndex:h().number},en.propTypes={children:h().node,id:h().string,activeKey:h().any,mountOnEnter:h().bool,unmountOnExit:h().bool,className:h().string};const tn=[],nn="drafts",rn="scheduled_posts";function an(e){var t,n;const o=(0,P.useHistory)(),l=(0,P.useLocation)(),c=l.pathname.includes(ne.Mm),d=l.pathname.includes(ne.pj),u=(0,s.useSelector)(L.H7),m=null!==(t=null==u?void 0:u.name)&&void 0!==t?t:"",p=null!==(n=null==u?void 0:u.id)&&void 0!==n?n:"",f=(0,r.useMemo)((()=>(0,i.TY)()),[]),h=(0,s.useSelector)((e=>f(e,p,!0))),E=(0,r.useCallback)((e=>{e===nn?o.push("/".concat(m,"/drafts")):e===rn&&o.push("/".concat(m,"/scheduled_posts"))}),[o,m]),y=(0,r.useMemo)((()=>a().createElement("div",{className:"drafts_tab_title"},a().createElement(g.FormattedMessage,{id:"schedule_post.tab.heading",defaultMessage:"Scheduled"}),(null==h?void 0:h.length)>0&&a().createElement(Vt,{className:"badge",badgeContent:h.length}))),[null==h?void 0:h.length]),v=(0,r.useMemo)((()=>a().createElement("div",{className:"drafts_tab_title"},a().createElement(g.FormattedMessage,{id:"drafts.heading",defaultMessage:"Drafts"}),e.drafts.length>0&&a().createElement(Vt,{className:"badge",badgeContent:e.drafts.length}))),[e.drafts.length]),_=(0,r.useMemo)((()=>c?nn:d?rn:""),[c,d]);return a().createElement(en,{id:"draft_tabs",activeKey:_,mountOnEnter:!0,unmountOnExit:!0,onSelect:E},a().createElement($t,{eventKey:nn,title:v,unmountOnExit:!0,tabClassName:"drafts_tab",tabIndex:0},a().createElement(Nt,{drafts:e.drafts,currentUser:e.currentUser,userDisplayName:e.userDisplayName,userStatus:e.userStatus})),a().createElement($t,{eventKey:rn,title:y,unmountOnExit:!0,tabClassName:"drafts_tab"},a().createElement(Jt,{scheduledPosts:h||tn,currentUser:e.currentUser,userDisplayName:e.userDisplayName,userStatus:e.userStatus})))}an.propTypes={drafts:h().array.isRequired,userDisplayName:h().string.isRequired};const sn=[];function on(){const e=(0,s.useDispatch)(),t=(0,s.useSelector)(i.Ck),n=(0,r.useMemo)((()=>(0,p.$P)()),[]),f=(0,s.useSelector)(n),h=(0,s.useSelector)(o.HW),g=(0,s.useSelector)((e=>(0,c.CB)(e,h.id))),E=(0,s.useSelector)(l.K3),y=(0,r.useMemo)((()=>(0,d.R4)(h,E)),[h,E]);return(0,r.useEffect)((()=>(e((0,u.bT)(kt.L.Page,kt.j.Drafts)),e(m.tU),()=>{e(m.ED)})),[e]),t?a().createElement(Tt,null,a().createElement(an,{drafts:f||sn,currentUser:h,userDisplayName:y,userStatus:g})):a().createElement(Tt,null,a().createElement(Nt,{drafts:f||sn,currentUser:h,userDisplayName:y,userStatus:g}))}const ln=(0,r.memo)(on)},41125:(e,t,n)=>{n.d(t,{A:()=>c}),n(29206),n(57406),n(55448);var r=n(71633),a=n.n(r),s=n(97023),o=n.n(s);const l=["level","heading","subtitle","right"],i=[s.Fragment,"h1","h2","h3","h4","h5","h6"],c=e=>{let{level:t=0,heading:n,subtitle:r,right:s}=e,c=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,l);const d=i[t];return o().createElement("header",Object.assign({},c,{className:a()("Header",c.className)}),o().createElement("div",{className:"left"},o().createElement(d,null,n),r?o().createElement("p",null,r):null),o().createElement("div",{className:"spacer"}),s)}},54302:(e,t,n)=>{n.d(t,{I:()=>s}),n(3188),n(30973),n(17046),n(36169);var r=n(97023),a=n(81911);function s(){const{search:e}=(0,a.useLocation)();return(0,r.useMemo)((()=>new URLSearchParams(e)),[e])}}}]);
//# sourceMappingURL=2794.e034a79db3c3393d9abb.js.map