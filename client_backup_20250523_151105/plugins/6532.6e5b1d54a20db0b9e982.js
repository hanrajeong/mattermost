"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[6532],{96532:(e,t,s)=>{s.r(t),s.d(t,{default:()=>de,makeMapStateToProps:()=>ue}),s(3188),s(30973);var r=s(23453),a=s(5908),n=s(30413),i=s(17085),o=s(26614),l=s(14776),c=s(7430),u=s(15755),d=s(59935),m=s(65357),h=s(89247),p=s(62688),f=s.n(p),g=(s(17046),s(57406),s(55448),s(29206),s(43813),s(4290),s(46177)),v=s.n(g),b=s(97023),y=s.n(b),_=s(14778),P=s(14696),E=s(30138),M=s(83007),R=s(78451),S=(s(74883),s(8361)),T=s(65952),C=s(16230),w=s(79342),O=s(79751),I=s(50375),U=s(63234),q=s(7380),D=s(71633),j=s.n(D),x=s(77828),N=s(40693),F=s(67277),L=s(61767),A=s(19542),k=s(72429),G=s(85873);function H(e){const{currentUserId:t,option:s,status:r}=e,{id:a,delete_at:n,is_bot:i=!1,last_picture_update:o}=s,l=(0,G.xK)(s);let c=l;return s.id===t?c=y().createElement(_.FormattedMessage,{id:"more_direct_channels.directchannel.you",defaultMessage:"{displayname} (you)",values:{displayname:l}}):s.delete_at&&(c=y().createElement(_.FormattedMessage,{id:"more_direct_channels.directchannel.deactivated",defaultMessage:"{displayname} - Deactivated",values:{displayname:l}})),y().createElement(y().Fragment,null,y().createElement(L.A,{src:N.mT.getProfilePictureUrl(a,o),status:n||i?void 0:r,size:"md"}),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},c,i&&y().createElement(A.A,null),(0,w.P)(s.roles)&&y().createElement(k.A,null),y().createElement(F.A,{userID:s.id,showTooltip:!0,emojiSize:15,spanStyle:{display:"flex",flex:"0 0 auto",alignItems:"center"}})),!i&&y().createElement("div",{className:"more-modal__description"},s.email)))}H.propTypes={currentUserId:f().string.isRequired,status:f().string.isRequired};const V=(0,r.connect)((function(e,t){return{currentUserId:(0,c.WR)(e),status:(0,c.CB)(e,t.option.id)}}))(H);function z(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function W(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Y(e){return"G"===(null==e?void 0:e.type)}function B(e){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?z(Object(s),!0).forEach((function(t){W(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):z(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({value:e.id,label:Y(e)?e.display_name:e.username},e)}const J={useTime:!1,style:"long",ranges:[{within:["minute",-1],display:["second",0]},{within:["hour",-1],display:["minute"]},{within:["hour",-24],display:["hour"]},{within:["day",-30],display:["day"]},{within:["month",-11],display:["month"]},{within:["year",-1e3],display:["year"]}]},X=y().forwardRef(((e,t)=>{const{option:s,isMobileView:r,isSelected:a,add:n,select:i}=e,o=(0,_.useIntl)(),{last_post_at:l}=s;let c;c=Y(s)?y().createElement(K,{option:s}):y().createElement(V,{option:s});const u=(0,b.useCallback)((()=>n(s)),[s,n]),d=(0,b.useCallback)((()=>i(s)),[s,i]);return y().createElement("div",{ref:t,className:j()("more-modal__row clickable",{"more-modal__row--selected":a}),onClick:u,onMouseEnter:d},c,r&&Boolean(l)&&y().createElement("div",{className:"more-modal__lastPostAt"},y().createElement(x.Ay,Object.assign({},J,{value:l}))),y().createElement("div",{className:"more-modal__actions"},y().createElement("button",{className:"more-modal__actions--round","aria-label":o.formatMessage({id:"more_direct_channels.new_convo_add.label",defaultMessage:"Add option {label}"},{label:s.label})},y().createElement("i",{className:"icon icon-plus"}))))}));X.propTypes={isMobileView:f().bool.isRequired,isSelected:f().bool.isRequired,add:f().func.isRequired,select:f().func.isRequired},X.displayName="ListItem";const Q=X;function K(e){const{option:t}=e;return y().createElement(y().Fragment,null,y().createElement("div",{className:"more-modal__gm-icon"},t.profiles.length),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},y().createElement("span",null,t.profiles.map((e=>"@".concat(e.username))).join(", ")))))}const Z=(0,r.connect)((function(e){return{isMobileView:(0,q.w3)(e)}}),null,null,{forwardRef:!0})(Q),$=R.Ay.MAX_USERS_IN_GM-1,ee=y().forwardRef(((e,t)=>{const s=(0,b.useCallback)(((t,s,r,a)=>y().createElement(Z,{ref:s?e.selectedItemRef:void 0,key:"more_direct_channels_list_"+t.value,option:t,isSelected:s,add:r,select:a})),[e.selectedItemRef]),a=(0,r.useDispatch)(),n=(0,b.useCallback)((t=>t.id===e.currentUserId||Boolean(t.delete_at)),[e.currentUserId]),i=(0,_.useIntl)();let o,l;e.isExistingChannel&&(o=e.values.length>=$?y().createElement(_.FormattedMessage,{id:"more_direct_channels.new_convo_note.full",defaultMessage:"You've reached the maximum number of people for this conversation. Consider creating a private channel instead."}):y().createElement(_.FormattedMessage,{id:"more_direct_channels.new_convo_note",defaultMessage:"This will start a new conversation. If you're adding a lot of people, consider creating a private channel instead."})),l=$>e.values.length?y().createElement(_.FormattedMessage,{id:"multiselect.numPeopleRemaining",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can add {num, number} more {num, plural, one {person} other {people}}. ",values:{num:$-e.values.length}}):y().createElement(_.FormattedMessage,{id:"multiselect.maxPeople",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can't add more than {num} people. Please <a>create a channel</a> to include more people.",values:{num:$,a:t=>y().createElement("a",{href:"#",onClick:t=>(t=>{t.preventDefault(),e.handleHide(),a((0,O.q)({modalId:R.IQ.NEW_CHANNEL_MODAL,dialogType:U.default}))})(t)},t)}});const c=(0,b.useMemo)((()=>e.options.map(B)),[e.options]);return y().createElement(I.A,{ref:t,options:c,optionRenderer:s,intl:i,selectedItemRef:e.selectedItemRef,values:e.values,valueRenderer:se,ariaLabelRenderer:re,perPage:50,handlePageChange:e.handlePageChange,handleInput:e.search,handleDelete:e.handleDelete,handleAdd:e.addValue,handleSubmit:e.handleSubmit,noteText:o,maxValues:$,numRemainingText:l,buttonSubmitText:y().createElement(_.FormattedMessage,{id:"multiselect.go",defaultMessage:"Go"}),buttonSubmitLoadingText:y().createElement(_.FormattedMessage,{id:"multiselect.loading",defaultMessage:"Loading..."}),submitImmediatelyOn:n,saving:e.saving,loading:e.loading,users:e.users,totalCount:e.totalCount,placeholderText:i.formatMessage({id:"multiselect.placeholder",defaultMessage:"Search and add members"})})}));ee.propTypes={addValue:f().func.isRequired,currentUserId:f().string.isRequired,handleDelete:f().func.isRequired,handlePageChange:f().func.isRequired,handleSubmit:f().func.isRequired,handleHide:f().func.isRequired,isExistingChannel:f().bool.isRequired,loading:f().bool.isRequired,options:f().array.isRequired,saving:f().bool.isRequired,search:f().func.isRequired,totalCount:f().number.isRequired,users:f().array.isRequired,values:f().array.isRequired};const te=ee;function se(e){return e.data.username}function re(e){var t;return null!==(t=null==e?void 0:e.username)&&void 0!==t?t:""}function ae(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ne(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(s),!0).forEach((function(t){ie(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ae(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ie(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const oe=(0,r.connect)((function(){const e=function(){const e=(0,S.Mz)("getUsersWithDMs",c.WR,T.ou,((e,t)=>t),((e,t,s)=>{const r=Object.values(t).filter((e=>e.type===R.Ay.DM_CHANNEL)),a=[];for(const t of r){const r=(0,C.r4)(e,t.name),n=s.find((e=>e.id===r));n&&0!==t.last_post_at&&a.push(ne(ne({},n),{},{last_post_at:t.last_post_at}))}return a})),t=(0,S.Mz)("getFilteredGroupChannels",T.M6,(e=>e.views.search.modalSearch),((e,t)=>t),((e,t,s)=>e.filter((e=>(!t||0!==(0,w.V3)(e.profiles,t).length)&&!(s&&!s.every((t=>e.profiles.find((e=>e.id===t.id)))))&&e.last_post_at>0))));return(0,S.Mz)("makeGetOptions",e,((e,s,r)=>t(e,r)),((e,t)=>t),(e=>Boolean(e.views.search.modalSearch)),((e,t,s,r)=>{const a=[...e,...t].sort(((e,t)=>t.last_post_at-e.last_post_at));if(!r&&a.length>0)return a.slice(0,20);const n=s.filter((t=>0===t.delete_at&&!e.some((e=>e.id===t.id)))).map((e=>ne(ne({},e),{},{last_post_at:0})));return n.sort(((e,t)=>e.username.localeCompare(t.username))),[...a,...n]}))}();return(t,s)=>({options:e(t,s.users,s.values)})}))(te);function le(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ce extends y().PureComponent{constructor(e){var t;super(e),t=this,le(this,"loadModalData",(()=>{this.getUserProfiles(),this.props.actions.getTotalUsersStats(),this.props.actions.loadProfilesMissingStatus(this.props.users)})),le(this,"setUsersLoadingState",(e=>{this.setState({loadingUsers:e})})),le(this,"handleHide",(()=>{this.props.actions.setModalSearchTerm(""),this.setState({show:!1})})),le(this,"handleExit",(()=>{var e,t,s,r;null===(e=(t=this.props).onExited)||void 0===e||e.call(t),null===(s=(r=this.props).onModalDismissed)||void 0===s||s.call(r),this.exitToChannel?(0,M.J)().push(this.exitToChannel):this.props.focusOriginElement&&setTimeout((()=>{(0,E.p)(this.props.focusOriginElement,!0)}),0)})),le(this,"handleSubmit",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.state.values;const{actions:s}=t.props;if(t.state.saving)return;const r=e.map((e=>e.id));if(0===r.length)return;t.setState({saving:!0});const a=e=>{const{data:s,error:r}=e;t.setState({saving:!1}),r||(t.exitToChannel="/"+t.props.currentTeamName+"/channels/"+s.name,t.handleHide())};1===r.length?s.openDirectChannelToUserId(r[0]).then(a):s.openGroupChannelToUserIds(r).then(a)})),le(this,"addValue",(e=>{if(Y(e))this.addUsers(e.profiles);else{const t=[...this.state.values];t.includes(e)||t.push(e),this.setState({values:t})}})),le(this,"addUsers",(e=>{const t=[...this.state.values],s=t.map((e=>e.id));for(const r of e)s.includes(r.id)||t.push(B(r));this.setState({values:t})})),le(this,"getUserProfiles",(e=>{const t=e?e+1:0;"any"===this.props.restrictDirectMessage?this.props.actions.getProfiles(t,100).then((()=>{this.setUsersLoadingState(!1)})):this.props.actions.getProfilesInTeam(this.props.currentTeamId||"",t,100).then((()=>{this.setUsersLoadingState(!1)}))})),le(this,"handlePageChange",((e,t)=>{e>t&&(this.setUsersLoadingState(!0),this.getUserProfiles(e))})),le(this,"resetPaging",(()=>{var e;null===(e=this.multiselect.current)||void 0===e||e.resetPaging()})),le(this,"search",v()((e=>{this.props.actions.setModalSearchTerm(e)}),250)),le(this,"handleDelete",(e=>{this.setState({values:e})})),this.searchTimeoutId=0,this.multiselect=y().createRef(),this.selectedItemRef=y().createRef();const s=[];if(e.currentChannelMembers)for(let t=0;t<e.currentChannelMembers.length;t++){const r=Object.assign({},e.currentChannelMembers[t]);r.id!==e.currentUserId&&s.push(B(r))}this.state={values:s,show:!0,search:!1,saving:!1,loadingUsers:!0}}updateFromProps(e){if(e.searchTerm!==this.props.searchTerm){clearTimeout(this.searchTimeoutId);const e=this.props.searchTerm;if(""===e)this.resetPaging();else{const t="any"===this.props.restrictDirectMessage?"":this.props.currentTeamId;this.searchTimeoutId=setTimeout((async()=>{this.setUsersLoadingState(!0);const[{data:s},{data:r}]=await Promise.all([this.props.actions.searchProfiles(e,{team_id:t}),this.props.actions.searchGroupChannels(e)]);s&&this.props.actions.loadStatusesForProfilesList(s),r&&this.props.actions.loadProfilesForGroupChannels(r),this.resetPaging(),this.setUsersLoadingState(!1)}),R.Ay.SEARCH_TIMEOUT_MILLISECONDS)}}e.users.length!==this.props.users.length&&this.props.actions.loadProfilesMissingStatus(this.props.users)}componentDidUpdate(e){this.updateFromProps(e)}render(){const e=y().createElement(oe,{addValue:this.addValue,currentUserId:this.props.currentUserId,handleDelete:this.handleDelete,handlePageChange:this.handlePageChange,handleSubmit:this.handleSubmit,handleHide:this.handleHide,isExistingChannel:this.props.isExistingChannel,loading:this.state.loadingUsers,saving:this.state.saving,search:this.search,selectedItemRef:this.selectedItemRef,totalCount:this.props.totalCount,users:this.props.users,values:this.state.values}),t=y().createElement(_.FormattedMessage,{id:"more_direct_channels.title",defaultMessage:"Direct Messages"});return y().createElement(P.zW,{id:"moreDmModal",className:"a11y__modal more-modal more-direct-channels more-direct-channels-generic-modal",show:this.state.show,modalHeaderText:t,onExited:this.handleExit,onHide:this.handleExit,compassDesign:!0,bodyPadding:!1,onEntered:this.loadModalData,modalLocation:"top",delayFocusTrap:!0},y().createElement("div",{role:"application"},e))}}le(ce,"propTypes",{currentUserId:f().string.isRequired,currentTeamId:f().string,currentTeamName:f().string,searchTerm:f().string.isRequired,users:f().array.isRequired,totalCount:f().number.isRequired,currentChannelMembers:f().array,isExistingChannel:f().bool.isRequired,restrictDirectMessage:f().string,onModalDismissed:f().func,onExited:f().func,actions:f().shape({getProfiles:f().func.isRequired,getProfilesInTeam:f().func.isRequired,loadProfilesMissingStatus:f().func.isRequired,getTotalUsersStats:f().func.isRequired,loadStatusesForProfilesList:f().func.isRequired,loadProfilesForGroupChannels:f().func.isRequired,openDirectChannelToUserId:f().func.isRequired,openGroupChannelToUserIds:f().func.isRequired,searchProfiles:f().func.isRequired,searchGroupChannels:f().func.isRequired,setModalSearchTerm:f().func.isRequired}).isRequired,focusOriginElement:f().string.isRequired});const ue=()=>{const e=(0,c.T_)();return(t,s)=>{var r;const a=(0,c.WR)(t);let n;s.isExistingChannel&&(n=(0,c.Gv)(t));const i=(0,o.zj)(t).RestrictDirectMessage,u=t.views.search.modalSearch;let d,m;"true"===(0,o.Y6)(t,"EnableSharedChannelsDMs")||(d={exclude_remote:!0}),m=u?"any"===i?e(t,u,!1,d):(0,c.QJ)(t,u,!1,d):"any"===i?(0,c.r7)(t,d):(0,c.G1)(t,d);const h=(0,l.H7)(t),p=(0,c.ig)(t)||{total_users_count:0};return{currentTeamId:null==h?void 0:h.id,currentTeamName:null==h?void 0:h.name,searchTerm:u,users:m,currentChannelMembers:n,currentUserId:a,restrictDirectMessage:i,totalCount:null!==(r=p.total_users_count)&&void 0!==r?r:0}}},de=(0,r.connect)(ue,(function(e){return{actions:(0,a.bindActionCreators)({getProfiles:i.r7,getProfilesInTeam:i.xJ,loadProfilesMissingStatus:d.X,getTotalUsersStats:i.ig,loadStatusesForProfilesList:d.Y5,loadProfilesForGroupChannels:m.HJ,openDirectChannelToUserId:u.q6,openGroupChannelToUserIds:u.Xz,searchProfiles:i.U,searchGroupChannels:n.OW,setModalSearchTerm:h.qv},e)}}))(ce)}}]);
//# sourceMappingURL=6532.6e5b1d54a20db0b9e982.js.map