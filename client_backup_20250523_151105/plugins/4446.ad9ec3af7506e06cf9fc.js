"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[4446],{92801:(e,n,a)=>{a.d(n,{A:()=>h});var t=a(62688),l=a.n(t),i=a(97023),o=a.n(i),r=a(23453),s=a(92387),d=a.n(s),c=a(85406),u=a(26614),m=a(88533),p=a(18221),k=a(78138),f=a(92008);const g=e=>{let{type:n,emoji:a,imageUrl:t,fileInfo:l,size:i=16}=e,s="link"===n?o().createElement(c.BookOutlineIcon,{size:i}):o().createElement(c.FileGenericOutlineIcon,{size:i});const d=a&&(0,k.at)(a),g=(0,r.useSelector)((e=>"true"===(0,u.zj)(e).HasImageProxy));return d?s=o().createElement(m.A,{emojiName:d,size:i}):t?s=o().createElement(v,{src:(0,f.AE)(t,g),size:i}):l&&(s=o().createElement(p.A,{fileInfo:l,disablePreview:!0})),o().createElement(b,{$size:i},s)};g.propTypes={emoji:l().string,imageUrl:l().string,size:l().oneOf([16,24])};const h=g,b=d().div.withConfig({displayName:"Icon"})(["padding:3px 1px 3px 2px;flex-shrink:0;display:flex;align-items:center;.file-icon{width:","px;height:","px;background-size:","px ","px;margin-top:1px;}"],(e=>{let{$size:n}=e;return n}),(e=>{let{$size:n}=e;return n}),(e=>{let{$size:n}=e;return.8*n}),(e=>{let{$size:n}=e;return n})),v=d().img.withConfig({displayName:"BookmarkIconImg"})(["width:","px;height:","px;"],(e=>{let{size:n}=e;return n}),(e=>{let{size:n}=e;return n}))},81994:(e,n,a)=>{a.d(n,{A:()=>S});var t=a(62688),l=a.n(t),i=(a(17046),a(83931),a(43813),a(10844),a(1112),a(97023)),o=a.n(i),r=a(14778),s=a(23453),d=a(92387),c=a.n(d),u=a(85406),m=a(14696),p=a(69813),k=a(26614),f=a(43716),g=a(62742),h=a(3964),b=a(98566),v=a(53654),y=a(78451),E=a(19513),C=a(63155),_=a(85873),x=(a(29206),a(30535)),w=a(92801);const I=e=>{var n;let{maxLength:a,type:t,imageUrl:l,fileInfo:s,emoji:d,setEmoji:c,placeholder:m,displayName:p,setDisplayName:k,showEmojiPicker:f,setShowEmojiPicker:g,onAddCustomEmojiClick:h}=e;const{formatMessage:v}=(0,r.useIntl)(),C=(0,i.useRef)(null),_=o().createElement(w.A,{type:t,size:24,emoji:d,fileInfo:s,imageUrl:l}),I=()=>{c("")},j=(0,i.useCallback)((e=>{k(e.currentTarget.value)}),[]),{emojiPicker:B,getReferenceProps:z,setReference:S}=(0,x.A)({showEmojiPicker:f,setShowEmojiPicker:g,onAddCustomEmojiClick:h,onEmojiClick:e=>{g(!1);const n="short_name"in e?e.short_name:e.name;c(":".concat(n,":")),C.current&&document.dispatchEvent(new CustomEvent(y.pn.FOCUS,{detail:{target:C.current,keyboardOnly:!0}}))}});return o().createElement(o().Fragment,null,o().createElement(A,null,o().createElement("button",Object.assign({ref:S,type:"button",onClick:()=>g((e=>!e)),onKeyDown:e=>{(0,E.e)(e,y.Ay.KeyCodes.ENTER)&&e.stopPropagation()},"aria-label":v({id:"emoji_picker.emojiPicker.button.ariaLabel",defaultMessage:"select an emoji"}),className:"channelBookmarksMenuButton emoji-picker__container BookmarkCreateModal__emoji-button"},z()),_,o().createElement(u.ChevronDownIcon,{size:"12px"})),B,o().createElement(b.A,{maxLength:a,type:"text",name:"bookmark-display-name",onChange:j,value:null!==(n=null!=p?p:m)&&void 0!==n?n:"",placeholder:m,"data-testid":"titleInput",useLegend:!1}),o().createElement(M,{visible:Boolean(d),tabIndex:0,onClick:I,onKeyDown:e=>{((0,E.e)(e,y.Ay.KeyCodes.ENTER)||(0,E.e)(e,y.Ay.KeyCodes.SPACE))&&(e.stopPropagation(),I())}},o().createElement(r.FormattedMessage,{id:"channel_bookmarks.create.title_input.clear_emoji",defaultMessage:"Remove emoji"}))))};I.propTypes={maxLength:l().number.isRequired,showEmojiPicker:l().bool.isRequired,onAddCustomEmojiClick:l().func};const M=c().a.withConfig({displayName:"Clear"})(["font-size:12px;visibility:",";"],(e=>{let{visible:n}=e;return n?"visible":"hidden"})),A=c().div.withConfig({displayName:"NameWrapper"})(["position:relative;> button{position:absolute;left:1px;top:1px;z-index:5;width:57px;height:44px;border-radius:4px 0 0 4px;border-right:1px solid rgba(var(--center-channel-color-rgb),0.16);align-items:center;justify-content:center;gap:0;padding-left:6px;padding-right:2px;svg{flex-shrink:0;}}.Input_container{}.Input_wrapper{padding-left:7rem;}"]),j=I;var B=a(97026);function z(e){var n,a,t,l;let{bookmark:d,bookmarkType:c,file:x,channelId:w,onExited:I,onConfirm:M,onHide:A}=e;const{formatMessage:z}=(0,r.useIntl)(),S=(0,s.useDispatch)(),P=null!==(n=null!==(a=null==d?void 0:d.type)&&void 0!==a?a:c)&&void 0!==n?n:"link",[q,U]=(0,i.useState)(!1),[H,$]=(0,i.useState)(null!==(t=null==d?void 0:d.emoji)&&void 0!==t?t:""),[W,G]=(0,i.useState)(null==d?void 0:d.display_name),[Q,V]=(0,i.useState)(),[X,Y]=(0,i.useState)(!1),[J,Z]=(0,i.useState)(""),ee=(0,i.useCallback)((e=>{(0,E.e)(e,y.Ay.KeyCodes.ESCAPE)&&!q&&A()}),[q,A]);(0,i.useEffect)((()=>(document.addEventListener("keydown",ee),()=>{document.removeEventListener("keydown",ee)})),[ee]);const ne=null==d?void 0:d.image_url,[ae,te]=(0,i.useState)(null!==(l=null==d?void 0:d.link_url)&&void 0!==l?l:""),le=(0,i.useRef)(ae),[ie,oe]=(0,i.useState)(),re=(0,i.useCallback)((e=>{te((n=>(le.current=n,e))),e||oe(void 0)}),[]),[se,{loading:de,suppressed:ce}]=K(ae===le.current?"":ae,((e,n)=>{n||oe(e);const a=(0,C.Uy)(e);V(a),G(a)})),ue=(0,i.useCallback)((e=>{const{value:n}=e.target;re(n)}),[]),me=(0,B.GX)(),[pe,ke]=(0,i.useState)(),[fe,ge]=(0,i.useState)(""),[he,be]=(0,i.useState)(null==d?void 0:d.file_id),ve=(0,i.useRef)(),ye=(0,s.useSelector)((e=>he&&(0,p.ly)(e,he)||void 0)),Ee=(0,s.useSelector)((e=>{const n=(0,k.zj)(e);return parseInt(n.MaxFileSize||"",10)})),Ce=Ee/1048576,_e=(0,i.useCallback)((e=>{var n;const a=null===(n=e.target.files)||void 0===n?void 0:n[0];a&&Be(a)}),[]),xe=(0,i.useRef)(null),we=o().createElement("input",{type:"file",id:"bookmark-create-file-input-in-modal",className:"bookmark-create-file-input",ref:xe,onChange:_e}),Ie=e=>{ke(e)},Me=e=>{let{file_infos:n}=e;ke(null);const a=null==n?void 0:n[0];a&&be(a.id),ge("")},Ae=()=>{ke(null),ge(z({id:"file_upload.generic_error_file",defaultMessage:"There was a problem uploading your file."}))},je=W||Q||("file"===P?null==ye?void 0:ye.name:null==d?void 0:d.link_url)||"",Be=e=>{if(ke(null),be(""),e.size>Ee)return void ge(z({id:"file_upload.fileAbove",defaultMessage:"File above {max}MB could not be uploaded: {filename}"},{max:Ce,filename:e.name}));if(0===e.size)return void ge(z({id:"file_upload.zeroBytesFile",defaultMessage:"You are uploading an empty file: {filename}"},{filename:e.name}));ge(""),je===(null==ye?void 0:ye.name)&&G(e.name),V(e.name);const n=(0,_.$C)();ve.current=S((0,f.Q)({file:e,name:e.name,type:e.type,rootId:"",channelId:w,clientId:n,onProgress:Ie,onSuccess:Me,onError:Ae},!0))};(0,i.useEffect)((()=>{x&&Be(x)}),[x]);const ze=(0,i.useCallback)((()=>{var e;null===(e=ve.current)||void 0===e||e.abort(),null==I||I()}),[I]),Se=je!==(null==d?void 0:d.display_name)||!(!(H||null!=d&&d.emoji)||H===(null==d?void 0:d.emoji))||!("file"!==P||!he||he===(null==d?void 0:d.file_id))||"link"===P&&Boolean(ae&&ae!==(null==d?void 0:d.link_url)),Ne=(()=>{if("link"===P){if(!ae||se)return!1;if(ae&&ce)return!0;if(ie||ae===(null==d?void 0:d.link_url))return!0}if("file"===P)return!(!ye||!je||fe)})(),Pe=(0,i.useCallback)((()=>{var e;"file"===P&&(null===(e=ve.current)||void 0===e||e.abort())}),[P]),Le=(0,i.useCallback)((async()=>{if(Y(!0),"link"===P){const e=(0,C.hB)(ae);if(!e)return void Z(z(D.linkInvalid));let n=e.toString();n.endsWith("/")&&(n=n.slice(0,-1));const{data:a}=await M({image_url:ne,link_url:n,emoji:H,display_name:je,type:"link"});Y(!1),a?(Z(""),A()):Z(z(D.saveError))}else if(ye){const{data:e}=await M({file_id:ye.id,display_name:je,type:"file",emoji:H});e?(Z(""),A()):Z(z(D.saveError))}}),[P,ae,M,A,ye,je,H,ne]),Fe=X||!Ne||!Se;let Te;de?Te=o().createElement(v.A,null):ie&&!se&&(Te=L);let Re=z(D.linkInfoMessage);if(ce){const e=(0,C.hB)(ae);e&&(Re=z(D.invalidLinkMessage,{link:e.toString()}))}return o().createElement(m.zW,{enforceFocus:!q,keyboardEscape:!1,className:"channel-bookmarks-create-modal",modalHeaderText:z(d?D.editHeading:D.heading),confirmButtonText:z(d?D.saveText:D.addBookmarkText),handleCancel:Pe,handleConfirm:Le,handleEnterKeyPress:!Fe&&Le||void 0,onExited:ze,compassDesign:!0,isConfirmDisabled:Fe,autoCloseOnConfirmButton:!1,errorText:J},o().createElement(o().Fragment,null,"link"===P?o().createElement(o().Fragment,null,o().createElement(b.A,{maxLength:1024,type:"text",name:"bookmark-link",containerClassName:"linkInput",placeholder:z(D.linkPlaceholder),onChange:ue,hasError:Boolean(se),value:ae,"data-testid":"linkInput",autoFocus:!0,addon:Te,customMessage:se?{type:"error",value:se}:{value:Re}})):o().createElement(o().Fragment,null,o().createElement(F,null,o().createElement(r.FormattedMessage,{id:"channel_bookmarks.create.file_input.label",defaultMessage:"Attachment"})),o().createElement(R,{tabIndex:0,role:"button",disabled:!me,onClick:me&&(e=>{var n;const a=document.querySelector("\n            .channel-bookmarks-create-modal .post-image__download a,\n            .channel-bookmarks-create-modal a.file-preview__remove\n        ");a===e.target||null!=a&&a.contains(e.target)||null===(n=xe.current)||void 0===n||n.click()})||void 0},!pe&&ye&&o().createElement(O,null,o().createElement(g.A,{key:ye.id,fileInfo:ye,index:0})),pe&&o().createElement(h.A,{key:pe.clientId,clientId:pe.clientId,fileInfo:pe,handleRemove:()=>{var e;ke(null),be(null==d?void 0:d.file_id),V(void 0),null===(e=ve.current)||void 0===e||e.abort()}}),!ye&&!pe&&o().createElement("div",{className:"file-preview__container empty"}),o().createElement(T,null,o().createElement(u.PencilOutlineIcon,{size:24}),z(D.fileInputEdit)),we),fe&&o().createElement("div",{className:"Input___customMessage Input___error"},o().createElement("i",{className:"icon error icon-alert-circle-outline"}),o().createElement("span",null,fe))),o().createElement(N,null,o().createElement(F,null,o().createElement(r.FormattedMessage,{id:"channel_bookmarks.create.title_input.label",defaultMessage:"Title"})),o().createElement(j,{maxLength:64,type:P,imageUrl:ne,fileInfo:pe||ye,emoji:H,setEmoji:$,displayName:null==W?void 0:W.substring(0,64),placeholder:null==je?void 0:je.substring(0,64),setDisplayName:G,onAddCustomEmojiClick:A,showEmojiPicker:q,setShowEmojiPicker:U}))))}z.propTypes={channelId:l().string.isRequired,onExited:l().func.isRequired,onHide:l().func.isRequired};const S=z,N=c().div.withConfig({displayName:"TitleWrapper"})(["margin-top:20px;"]),P=c().span.withConfig({displayName:"CheckWrapper"})(["padding:0px 12px;display:flex;align-items:center;"]),L=o().createElement(P,null,o().createElement(u.CheckIcon,{size:20,color:"var(--sys-online-indicator)"})),F=c().span.withConfig({displayName:"FieldLabel"})(["display:inline-block;margin-bottom:8px;font-family:Open Sans;font-size:14px;line-height:16px;font-style:normal;font-weight:600;line-height:20px;"]),T=c().div.withConfig({displayName:"VisualButton"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:10px 24px;color:rgba(var(--center-channel-color-rgb),0.56);font-size:11px;font-weight:600;font-family:Open Sans;"]),R=c().div.withConfig({displayName:"FileInputContainer"})(["display:block;background:rgba(var(--center-channel-color-rgb),0.04);padding:12px;border-radius:8px;display:flex;&:hover:not([disabled]){background:rgba(var(--center-channel-color-rgb),0.08);color:rgba(var(--center-channel-color-rgb),0.72);cursor:pointer;}&:disabled{cursor:default;",'{opacity:0.4;}}input[type="file"]{opacity:0;width:0;height:0;}.file-preview__container,.file-preview{width:auto;height:auto;flex:1 1 auto;padding:0;&.empty{border:2px dashed rgba(var(--center-channel-color-rgb),0.16);border-radius :4px;}.post-image__column{width:100%;margin:0;}}'],T),q=c().a.withConfig({displayName:"LinkErrContinue"})(["color:unset !important;text-decoration:underline;"]),O=c().div.withConfig({displayName:"FileItemContainer"})(["display:flex;flex:1 1 auto;> div{width:100%;margin:0;}"]),D=(0,r.defineMessages)({heading:{id:"channel_bookmarks.create.title",defaultMessage:"Add a bookmark"},editHeading:{id:"channel_bookmarks.create.edit.title",defaultMessage:"Edit bookmark"},linkPlaceholder:{id:"channel_bookmarks.create.link_placeholder",defaultMessage:"Link"},linkInfoMessage:{id:"channel_bookmarks.create.link_info",defaultMessage:"Add a link to any post, file, or any external link"},invalidLinkMessage:{id:"channel_bookmarks.create.error.invalid_url.continuing_anyway",defaultMessage:"This may not be a valid link: {link}."},addBookmarkText:{id:"channel_bookmarks.create.confirm_add.button",defaultMessage:"Add bookmark"},saveText:{id:"channel_bookmarks.create.confirm_save.button",defaultMessage:"Save bookmark"},fileInputEdit:{id:"channel_bookmarks.create.file_input.edit",defaultMessage:"Edit"},linkInvalid:{id:"channel_bookmarks.create.error.invalid_url",defaultMessage:"Please enter a valid link. Could not parse: {link}."},saveError:{id:"channel_bookmarks.create.error.generic_save",defaultMessage:"There was an error trying to save the bookmark."}}),K=(e,n)=>{const{formatMessage:a}=(0,r.useIntl)(),[t,l]=(0,i.useState)(),[s,d]=(0,i.useState)(),[c,u]=(0,i.useState)(!1),m=(0,i.useRef)(),p=(0,i.useCallback)((e=>(l(e),d(void 0),u(!1),m.current=new AbortController,m.current.signal)),[]),k=(0,i.useCallback)((()=>{var e;null===(e=m.current)||void 0===e||e.abort("stale request"),m.current=void 0,l(void 0)}),[]);return(0,i.useEffect)((()=>{const t=setTimeout((async()=>{if(k(),!e)return;const t=(0,C.hB)(e);if(!t)return d(a(D.linkInvalid,{link:e})),void l(void 0);const i=p(t);try{await fetch(t,{mode:"no-cors",signal:AbortSignal.any([i,AbortSignal.timeout(1e4)])}),n(e)}catch(a){var s;i===(null===(s=m.current)||void 0===s?void 0:s.signal)&&d(((e,n)=>o().createElement(r.FormattedMessage,{id:"channel_bookmarks.create.error.invalid_url.continue_anyway",defaultMessage:"Could not find: {url}. Please enter a valid link, or <Confirm>continue anyway</Confirm>.",values:{url:e.toString(),Confirm:e=>o().createElement(q,{tabIndex:0,onClick:n,onKeyDown:e=>{"Enter"===e.key&&n()}},e)}}))(t,(()=>{n(e,!0),u(!0),d(void 0)})))}finally{l((e=>{if(e!==t)return e}))}}),250);return()=>clearTimeout(t)}),[e,p,k]),[s,{loading:Boolean(t),suppressed:c}]}},44446:(e,n,a)=>{a.d(n,{A:()=>E,m:()=>_});var t=a(62688),l=a.n(t),i=(a(43813),a(71633)),o=a.n(i),r=a(97023),s=a.n(r),d=a(14778),c=a(23453),u=a(92387),m=a.n(u),p=a(85406),k=a(58628),f=a(79751),g=a(70669),h=a(78451),b=a(81994),v=a(97026);function y(e){let{channelId:n,hasBookmarks:a,limitReached:t,canUploadFiles:l}=e;const{formatMessage:i}=(0,d.useIntl)(),r=!a,{handleCreateLink:c,handleCreateFile:u}=_(n),m=(0,v._4)(n,"add"),k=i({id:"channel_bookmarks.addBookmark",defaultMessage:"Add a bookmark"}),f=i({id:"channel_bookmarks.addBookmarkLimitReached",defaultMessage:"Cannot add more than {limit} bookmarks"},{limit:v.PM});let h;t?h=f:a&&(h=k);const b=i({id:"channel_bookmarks.addLink",defaultMessage:"Add a link"}),y=i({id:"channel_bookmarks.attachFile",defaultMessage:"Attach a file"});return m?s().createElement(C,{withLabel:r},s().createElement(g.mc,{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},menuButton:{id:"channelBookmarksPlusMenuButton",class:o()("channelBookmarksMenuButton",{withLabel:r,disabled:t}),children:s().createElement(s().Fragment,null,s().createElement(p.PlusIcon,{size:r?16:18}),r&&s().createElement("span",null,k)),"aria-label":k,disabled:t},menu:{id:"channelBookmarksPlusMenuDropdown"},menuButtonTooltip:h?{text:h}:void 0},s().createElement(g.q7,{key:"channelBookmarksAddLink",id:"channelBookmarksAddLink",onClick:c,leadingElement:s().createElement(p.LinkVariantIcon,{size:18}),labels:s().createElement("span",null,b)}),l&&s().createElement(g.q7,{key:"channelBookmarksAttachFile",id:"channelBookmarksAttachFile",onClick:u,leadingElement:s().createElement(p.PaperclipIcon,{size:18}),labels:s().createElement("span",null,y)}))):null}y.propTypes={channelId:l().string.isRequired,hasBookmarks:l().bool.isRequired,limitReached:l().bool.isRequired,canUploadFiles:l().bool.isRequired};const E=(0,r.memo)(y),C=m().div.withConfig({displayName:"MenuButtonContainer"})(["position:sticky;right:0;"," background:linear-gradient(to right,rgba(var(--center-channel-bg-rgb),.16),rgba(var(--center-channel-bg-rgb),1) 25%);"],(e=>{let{withLabel:n}=e;return!n&&(0,u.css)(["padding:0 1rem;"])})),_=e=>{const n=(0,c.useDispatch)(),a=(0,r.useCallback)((a=>{n((0,f.q)({modalId:h.IQ.CHANNEL_BOOKMARK_CREATE,dialogType:b.A,dialogProps:{channelId:e,bookmarkType:a?"file":"link",file:a,onConfirm:async a=>n((0,k.Ht)(e,a))}}))}),[e,n]);return{handleCreateLink:(0,r.useCallback)((()=>{a()}),[a]),handleCreateFile:(0,r.useCallback)((()=>{var e;const n=document.createElement("input");n.type="file",n.id="bookmark-create-file-input",n.hidden=!0,n.addEventListener("change",(()=>{var e;const t=null===(e=n.files)||void 0===e?void 0:e[0];t&&a(t),n.remove()})),n.addEventListener("cancel",n.remove),null===(e=document.getElementById("root-portal"))||void 0===e||e.appendChild(n),n.click()}),[a])}}}}]);
//# sourceMappingURL=4446.ad9ec3af7506e06cf9fc.js.map